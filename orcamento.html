<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imprimir Documento</title>
    
    <link rel="shortcut icon" href="logo.png" type="image/png">
    <link rel="icon" href="logo.png" type="image/png">
    <link rel="apple-touch-icon" href="logo.png">
    <meta name="mobile-web-app-capable" content="yes">

    <style>
        /* ESTILO A4 CL√ÅSSICO */
        body {
            background: #525659; /* Fundo cinza escuro (igual visualizador de PDF) */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .page {
            background: #fff;
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            box-sizing: border-box;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            position: relative;
        }

        /* CABE√áALHO */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #333;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .company-info h1 { margin: 0; color: #000; font-size: 24px; text-transform: uppercase; }
        .company-info p { margin: 2px 0; font-size: 12px; color: #555; }

        .doc-info { text-align: right; }
        .doc-title { font-size: 22px; font-weight: bold; color: #000; margin: 0; text-transform: uppercase; }
        .doc-number { font-size: 16px; color: #d32f2f; font-weight: bold; margin-top: 5px; }
        .doc-date { font-size: 12px; color: #666; margin-top: 5px; }

        /* DADOS DO CLIENTE */
        .section-title {
            background: #f3f4f6;
            padding: 5px 10px;
            font-size: 12px;
            font-weight: bold;
            border-left: 4px solid #000;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .client-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
            font-size: 13px;
        }
        .info-row { margin-bottom: 5px; }
        .info-label { font-weight: bold; color: #333; }

        /* TABELA DE ITENS */
        table { width: 100%; border-collapse: collapse; margin-bottom: 30px; font-size: 12px; }
        th { background: #000; color: #fff; padding: 10px; text-align: left; text-transform: uppercase; }
        td { padding: 10px; border-bottom: 1px solid #eee; }
        tr:nth-child(even) { background: #f9fafb; }
        .col-right { text-align: right; }

        /* TOTAIS */
        .totals-section {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 40px;
        }
        .totals-box {
            width: 250px;
            font-size: 13px;
        }
        .total-row { display: flex; justify-content: space-between; padding: 5px 0; }
        .total-row.final { font-size: 18px; font-weight: bold; border-top: 2px solid #000; margin-top: 10px; padding-top: 10px; }

        /* RODAP√â / CONTRATO */
        .footer-terms {
            margin-top: auto;
            border-top: 1px solid #ccc;
            padding-top: 20px;
            font-size: 10px;
            color: #666;
            text-align: justify;
            line-height: 1.5;
        }

        .signatures {
            margin-top: 50px;
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            text-align: center;
        }
        .sig-line { border-top: 1px solid #000; width: 40%; padding-top: 5px; }

        /* BOT√ÉO DE IMPRIMIR */
        .btn-print {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #00e0ff;
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            font-size: 16px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .btn-print:hover { transform: scale(1.05); background: #fff; }

        @media print {
            body { background: #fff; padding: 0; }
            .page { box-shadow: none; margin: 0; width: 100%; min-height: auto; padding: 0; }
            .btn-print { display: none; }
            @page { margin: 15mm; }
        }
    </style>
</head>
<body>

    <button class="btn-print" onclick="window.print()">
        <i class="fas fa-print"></i> IMPRIMIR
    </button>

    <div class="page">
        
        <div class="header">
            <div class="company-info" contenteditable="true">
                <h1>LM IMPORTS</h1> <p>CNPJ: 00.000.000/0001-00</p>
                <p>Rua Exemplo, 123, Centro - SP</p>
                <p>Tel: (11) 99999-9999 | Insta: @lmimports</p>
            </div>
            <div class="doc-info">
                <div class="doc-title" id="lbl-titulo">RECIBO</div>
                <div class="doc-number" id="lbl-numero">N¬∫ 0000</div>
                <div class="doc-date" id="lbl-data">01/01/2026</div>
            </div>
        </div>

        <div class="section-title">Dados do Cliente</div>
        <div class="client-grid">
            <div>
                <div class="info-row"><span class="info-label">Nome:</span> <span id="cli-nome">-</span></div>
                <div class="info-row"><span class="info-label">Endere√ßo:</span> <span id="cli-end">-</span></div>
            </div>
            <div>
                <div class="info-row"><span class="info-label">CPF:</span> <span id="cli-cpf">-</span></div>
                <div class="info-row"><span class="info-label">Tel:</span> <span id="cli-tel">-</span></div>
            </div>
        </div>

        <div class="section-title">Itens do Pedido</div>
        <table>
            <thead>
                <tr>
                    <th style="width: 10%;">Qtd</th>
                    <th>Descri√ß√£o</th>
                    <th class="col-right" style="width: 20%;">Valor</th>
                </tr>
            </thead>
            <tbody id="lista-itens">
                </tbody>
        </table>

        <div class="totals-section">
            <div class="totals-box">
                <div class="total-row">
                    <span>Subtotal:</span>
                    <span id="val-subtotal">R$ 0,00</span>
                </div>
                <div class="total-row" style="color: #d32f2f;">
                    <span>Desconto:</span>
                    <span id="val-desconto">- R$ 0,00</span>
                </div>
                <div class="total-row">
                    <span>Taxas/Outros:</span>
                    <span id="val-taxa">R$ 0,00</span>
                </div>
                <div class="total-row final">
                    <span>TOTAL:</span>
                    <span id="val-total">R$ 0,00</span>
                </div>
                <div style="margin-top: 10px; font-size: 11px; text-align: right; color: #666;">
                    <strong id="txt-pagamento">PIX</strong><br>
                    <span id="txt-parcelas"></span>
                </div>
            </div>
        </div>

        <div class="signatures">
            <div class="sig-line">
                LM IMPORTS<br>Vendedor
            </div>
            <div class="sig-line">
                ASSINATURA DO CLIENTE<br>
                <span id="sign-cli-nome" style="font-size:10px;"></span>
            </div>
        </div>

        <div class="footer-terms" contenteditable="true">
            <strong>TERMOS DE GARANTIA E VENDA:</strong><br>
            1. Garantia legal de 90 dias para defeitos de fabrica√ß√£o (eletr√¥nicos usados/novos).<br>
            2. N√£o cobrimos danos causados por mau uso, quedas, contato com l√≠quidos ou altera√ß√µes de software.<br>
            3. Trocas somente mediante apresenta√ß√£o deste documento.<br>
            4. Em caso de desist√™ncia (compras online), o prazo √© de 7 dias conforme CDC.<br>
            <br>
            Declaro ter recebido os produtos listados acima em perfeito estado de funcionamento e confer√™ncia.
        </div>

    </div>

    <script>
        // --- üîí KILL SWITCH ---
        const DATA_LIMITE = new Date('2030-01-01'); 
        if(new Date() > DATA_LIMITE) { document.body.innerHTML = ''; throw new Error("Bloqueado"); }

        window.onload = function() {
            const dadosStr = localStorage.getItem('dadosRecibo');
            if(!dadosStr) {
                alert("Nenhum dado encontrado!");
                window.close();
                return;
            }
            const dados = JSON.parse(dadosStr);

            // 1. T√çTULO E N√öMERO (CORRE√á√ÉO)
            const titulo = dados.isOrcamento ? "OR√áAMENTO" : "PEDIDO DE VENDA";
            document.getElementById('lbl-titulo').innerText = titulo;
            document.getElementById('lbl-numero').innerText = "N¬∫ " + (dados.numeroPedido || "----");
            document.getElementById('lbl-data').innerText = dados.data;

            // 2. CLIENTE
            document.getElementById('cli-nome').innerText = dados.cliente;
            document.getElementById('cli-cpf').innerText = dados.cpf;
            document.getElementById('cli-tel').innerText = dados.tel;
            document.getElementById('cli-end').innerText = dados.endereco;
            document.getElementById('sign-cli-nome').innerText = dados.cliente;

            // 3. ITENS
            const tbody = document.getElementById('lista-itens');
            let subtotal = 0;

            dados.itens.forEach(item => {
                const tr = document.createElement('tr');
                let desc = item.nome;
                if(item.desc) desc += ` - ${item.desc}`;
                
                let valor = parseFloat(item.preco);
                let visualValor = valor.toLocaleString('pt-br',{style:'currency', currency:'BRL'});

                // Tratamento visual para trocas e brindes
                if(item.isTroca) {
                    desc = `[ENTRADA] ${desc}`;
                    tr.style.color = "#eab308"; // Amarelo escuro na tela
                } else if (item.isBrinde) {
                    desc = `[BRINDE] ${desc}`;
                    visualValor = "R$ 0,00";
                    valor = 0;
                } else {
                    subtotal += valor;
                }

                tr.innerHTML = `
                    <td>1</td>
                    <td>${desc}</td>
                    <td class="col-right">${visualValor}</td>
                `;
                tbody.appendChild(tr);
            });

            // 4. VALORES FINAIS
            document.getElementById('val-subtotal').innerText = subtotal.toLocaleString('pt-br',{style:'currency', currency:'BRL'});
            
            // Desconto
            const desc = parseFloat(dados.descontoManual) || 0;
            document.getElementById('val-desconto').innerText = "- " + desc.toLocaleString('pt-br',{style:'currency', currency:'BRL'});

            // Taxas
            const taxa = parseFloat(dados.taxaMaquininha) || 0;
            document.getElementById('val-taxa').innerText = "+ " + taxa.toLocaleString('pt-br',{style:'currency', currency:'BRL'});

            // Total Final
            document.getElementById('val-total').innerText = parseFloat(dados.total).toLocaleString('pt-br',{style:'currency', currency:'BRL'});

            // Pagamento
            document.getElementById('txt-pagamento').innerText = dados.pagamento;
            document.getElementById('txt-parcelas').innerText = dados.textoParcelas || "";

            // AUTO PRINT (Apenas se for venda final, n√£o se for preview)
            if(dados.autoPrint) {
                setTimeout(() => window.print(), 800);
            }
        };
    </script>
</body>
</html>
