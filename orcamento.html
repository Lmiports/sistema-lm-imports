<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Recibo</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');

        /* TIRA AS LETRAS DO NAVEGADOR (URL/DATA) */
        @page { size: A4; margin: 0; }

        body { 
            font-family: 'Inter', sans-serif; 
            background: #555; /* Fundo escuro pra destacar a folha na tela */
            margin: 0; 
            padding: 20px; 
            display: flex; 
            justify-content: center; 
        }

        /* FOLHA A4 PERFEITA */
        .page {
            background: #fff;
            width: 210mm;
            min-height: 297mm;
            padding: 15mm;
            padding-bottom: 15mm;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            position: relative;
            box-sizing: border-box;
            margin: 0 auto;
        }

        /* TÍTULO DA PÁGINA (ESCONDIDO NA IMPRESSÃO) */
        title { display: none; }

        /* CABEÇALHO */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #000;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .logo-area img { max-height: 100px; max-width: 250px; }
        .company-info { text-align: right; font-size: 11px; line-height: 1.3; color: #333; }
        .company-info h2 { margin: 0; font-size: 18px; text-transform: uppercase; font-weight: 800; color: #000; }

        /* DOCUMENT TITLE */
        .doc-title {
            text-align: center;
            font-size: 20px;
            font-weight: 800;
            margin: 15px 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: #f0f0f0;
            padding: 8px;
            border-radius: 4px;
        }

        /* GRID DE DADOS */
        .meta-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; font-size: 12px; }
        .box { border: 1px solid #ddd; padding: 10px; border-radius: 4px; }
        .box-title { font-weight: bold; font-size: 10px; color: #888; text-transform: uppercase; margin-bottom: 5px; border-bottom: 1px solid #eee; padding-bottom: 2px; }

        /* INPUTS EDITÁVEIS NA TELA (INVISÍVEIS NA IMPRESSÃO) */
        .input-editable {
            border: none;
            border-bottom: 1px dashed #ccc; /* Guia visual na tela */
            font-family: inherit; font-size: inherit; background: transparent;
            color: #000; font-weight: 600; padding: 0; margin: 0; width: 100%;
        }
        .input-uppercase { text-transform: uppercase; } /* FORÇA MAIÚSCULA */

        /* TABELA */
        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; font-size: 11px; }
        th { background: #000; color: #fff; padding: 6px; text-align: left; text-transform: uppercase; font-weight: 600; }
        td { border-bottom: 1px solid #eee; padding: 6px; color: #333; }
        .col-valor { text-align: right; font-weight: bold; }
        
        /* TOTAIS */
        .totals-area { display: flex; justify-content: flex-end; }
        .totals-box { width: 220px; text-align: right; }
        .t-row { display: flex; justify-content: space-between; padding: 2px 0; font-size: 12px; }
        .t-total { font-size: 16px; font-weight: 800; border-top: 2px solid #000; margin-top: 5px; padding-top: 5px; }

        /* CONTRATO (EDITÁVEL) */
        .legal-terms {
            margin-top: 30px;
            font-size: 9px;
            text-align: justify;
            color: #444;
            line-height: 1.4;
            border: 1px solid transparent; /* Invisível na impressão */
            padding: 5px;
        }
        /* Efeito visual apenas na tela para saber que pode editar */
        .legal-terms:hover { background: #fffde7; border: 1px dashed #ccc; cursor: text; }
        
        .signatures { margin-top: 40px; display: flex; justify-content: space-between; padding: 0 30px; }
        .sig-line { width: 40%; border-top: 1px solid #000; text-align: center; font-size: 10px; padding-top: 5px; text-transform: uppercase; }

        /* ORÇAMENTO SUAVE */
        .orcamento-alert {
            display: none;
            margin-top: 30px;
            text-align: center;
            background: #f9f9f9; /* Fundo cinza bem claro */
            border-left: 4px solid #888; /* Barra lateral discreta */
            padding: 10px;
            font-size: 11px;
            color: #555;
        }

        /* RODAPÉ VERTICE */
        .system-footer {
            position: absolute;
            bottom: 5mm;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 7px;
            color: #ccc;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* BOTÕES FLUTUANTES (Não Imprimem) */
        .screen-btns { position: fixed; top: 20px; right: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 999; }
        .btn { padding: 12px 25px; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; text-decoration: none; color: #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.3); font-size: 12px; text-align: center; transition: 0.2s; }
        .btn-print { background: #22c55e; }
        .btn-close { background: #ef4444; }
        .btn:hover { transform: scale(1.05); }

        /* REGRAS DE IMPRESSÃO RIGOROSAS */
        @media print {
            body { background: #fff; padding: 0; }
            .page { box-shadow: none; width: 100%; height: 100%; padding: 15mm; margin: 0; border: none; }
            .screen-btns { display: none !important; }
            .input-editable { border-bottom: none !important; } /* Some o tracejado */
            .legal-terms:hover { background: transparent; border: none; } /* Remove fundo de edição */
            .orcamento-alert { border: 1px solid #eee; border-left: 4px solid #888; }
        }
    </style>
</head>
<body>

    <div class="screen-btns">
        <a href="#" onclick="window.print()" class="btn btn-print"><i class="fas fa-print"></i> IMPRIMIR / PDF</a>
        <a href="#" onclick="window.close()" class="btn btn-close">FECHAR</a>
    </div>

    <div class="page">
        
        <div class="header">
            <div class="logo-area">
                <img src="logo.png" alt="LM IMPORTS" onerror="this.style.display='none'; document.getElementById('logo-text').style.display='block'">
                <h1 id="logo-text" style="display:none; margin:0;">LM IMPORTS</h1>
            </div>
            <div class="company-info">
                <h2>LM IMPORTS</h2>
                <p>CNPJ: 57.554.129/0001-69</p>
                <p>Tel/WhatsApp: (11) 93305-0117</p>
                <p>Instagram: @marcelo.lmimportss</p>
            </div>
        </div>

        <div class="doc-title" id="titulo-doc">RECIBO DE VENDA</div>

        <div class="meta-grid">
            <div class="box">
                <div class="box-title">DADOS DO CLIENTE</div>
                <div id="cli-nome" style="font-weight:bold;">Nome do Cliente</div>
                <div id="cli-cpf">CPF: ---</div>
                <div id="cli-tel">Tel: ---</div>
                <div id="cli-end">Endereço: ---</div>
            </div>
            <div class="box">
                <div class="box-title">DADOS DO PEDIDO</div>
                <div class="t-row">
                    <span>Nº Pedido:</span> 
                    <input type="text" id="ped-num-input" class="input-editable" value="0000" style="width: 80px; text-align:right;">
                </div>
                <div class="t-row"><span>Data:</span> <span id="ped-data">--/--/----</span></div>
                <div class="t-row" style="margin-top:10px;">
                    <span>Vendedor:</span> 
                    <input type="text" id="vendedor-input" class="input-editable input-uppercase" value="VENDEDOR" style="text-align:right;">
                </div>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>PRODUTO / SERVIÇO</th>
                    <th>DETALHES</th>
                    <th class="col-valor">VALOR</th>
                </tr>
            </thead>
            <tbody id="lista-itens"></tbody>
        </table>

        <div class="totals-area">
            <div class="totals-box">
                <div class="t-row" style="color:#666;">SUBTOTAL: <span id="val-sub">R$ ...</span></div>
                <div class="t-row" style="color:red;">DESCONTO: <span id="val-desc">R$ 0,00</span></div>
                <div class="t-row" style="font-size:10px;">TAXAS/JUROS: <span id="val-taxa">R$ 0,00</span></div>
                <div class="t-row t-total">TOTAL: <span id="val-total">R$ 0,00</span></div>
                <div style="margin-top:5px; font-size:10px; font-weight:bold;" id="txt-pagamento">Pagamento: Pix</div>
            </div>
        </div>

        <div id="area-contrato">
            <div class="legal-terms" contenteditable="true" title="Clique para editar o texto">
                <strong>TERMOS DE GARANTIA E CONDIÇÕES</strong><br>
                1. A LM Imports oferece garantia de 90 (noventa) dias para defeitos de fabricação, conforme Art. 26 do CDC.<br>
                2. A garantia <strong>NÃO COBRE:</strong> Danos causados por líquidos, quedas, mau uso, telas quebradas ou violação do selo de garantia.<br>
                3. Em caso de troca, o produto deve estar nas mesmas condições estéticas do ato da venda.<br>
                4. O cliente declara ter testado todas as funções do aparelho e estar ciente de que se trata de um produto seminovo (se aplicável).
            </div>

            <div class="signatures">
                <div class="sig-line">LM IMPORTS</div>
                <div class="sig-line"><span id="sig-cli-nome">CLIENTE</span></div>
            </div>
        </div>

        <div id="area-orcamento" class="orcamento-alert">
            <strong>ESTE DOCUMENTO É UM ORÇAMENTO</strong><br>
            Validade: 10 Dias • Sujeito a alteração de valores e disponibilidade de estoque.
        </div>

        <div class="system-footer">
            VÉRTICE BI CORE • RODRIGO N CARVALHO 2026
        </div>

    </div>

    <script>
        const dados = JSON.parse(localStorage.getItem('dadosRecibo'));
        
        // Pega vendedor e joga para maiúsculo
        const usuarioLogado = localStorage.getItem('usuarioLogado') || "VENDEDOR";
        document.getElementById('vendedor-input').value = usuarioLogado.toUpperCase();

        if(dados) {
            // TÍTULO: Agora sempre "RECIBO DE VENDA" no preview também, 
            // a não ser que seja explicitamente Orçamento.
            let titulo = "RECIBO DE VENDA";
            if (dados.isOrcamento) titulo = "ORÇAMENTO";
            
            document.getElementById('titulo-doc').innerText = titulo;
            
            document.getElementById('ped-num-input').value = dados.numeroPedido;
            document.getElementById('ped-data').innerText = dados.data;
            document.getElementById('cli-nome').innerText = dados.cliente;
            document.getElementById('cli-cpf').innerText = "CPF: " + dados.cpf;
            document.getElementById('cli-tel').innerText = "Tel: " + dados.tel;
            document.getElementById('cli-end').innerText = dados.endereco;
            document.getElementById('sig-cli-nome').innerText = dados.cliente;

            const tbody = document.getElementById('lista-itens');
            dados.itens.forEach(item => {
                let nome = item.nome;
                let valor = parseFloat(item.preco);
                if(item.isBrinde) { valor = 0; nome += " (BRINDE)"; }
                
                tbody.innerHTML += `
                    <tr>
                        <td>${nome}</td>
                        <td>${item.desc}</td>
                        <td class="col-valor">${valor.toLocaleString('pt-br',{style:'currency', currency:'BRL'})}</td>
                    </tr>
                `;
            });

            document.getElementById('val-desc').innerText = "- " + dados.descontoManual.toLocaleString('pt-br',{style:'currency', currency:'BRL'});
            let taxas = dados.taxaMaquininha || 0;
            document.getElementById('val-taxa').innerText = "+ " + taxas.toLocaleString('pt-br',{style:'currency', currency:'BRL'});
            document.getElementById('val-total').innerText = dados.total.toLocaleString('pt-br',{style:'currency', currency:'BRL'});
            document.getElementById('txt-pagamento').innerText = `Forma de Pagamento: ${dados.pagamento} ${dados.textoParcelas || ''}`;

            if (dados.isOrcamento) {
                document.getElementById('area-contrato').style.display = 'none';
                document.getElementById('area-orcamento').style.display = 'block';
            } else {
                document.getElementById('area-contrato').style.display = 'block';
                document.getElementById('area-orcamento').style.display = 'none';
            }

            // AUTO IMPRESSÃO SOMENTE SE FOR VENDA FINAL (Não no preview)
            // O preview a gente quer editar, então não imprime sozinho.
            if(dados.autoPrint) {
                setTimeout(() => window.print(), 800);
            }
        }
    </script>
</body>
</html>


