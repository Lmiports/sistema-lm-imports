<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Imprimir Documento</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');

        /* LIMPA CABEÇALHO/RODAPÉ DO NAVEGADOR */
        @page { size: A4; margin: 0; }

        body { 
            font-family: 'Inter', sans-serif; 
            background: #555; 
            margin: 0; 
            padding: 20px; 
            display: flex; 
            justify-content: center; 
        }

        /* FOLHA A4 */
        .page {
            background: #fff;
            width: 210mm;
            min-height: 297mm;
            padding: 15mm;
            padding-bottom: 15mm;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            position: relative;
            box-sizing: border-box;
            margin: 0 auto;
        }

        /* ESCONDER BOTÕES NA IMPRESSÃO */
        .screen-btns { position: fixed; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 999; }
        .btn { padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: #fff; text-decoration: none; font-size: 13px; }
        .btn-print { background: #22c55e; }
        .btn-close { background: #ef4444; }

        /* HEADER */
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #000; padding-bottom: 15px; margin-bottom: 20px; }
        .logo-area img { max-height: 100px; max-width: 250px; }
        .company-info { text-align: right; font-size: 11px; line-height: 1.3; }
        .company-info h2 { margin: 0; font-size: 18px; text-transform: uppercase; font-weight: 800; }

        /* TÍTULO DO DOC */
        .doc-title { text-align: center; font-size: 22px; font-weight: 800; margin: 20px 0; text-transform: uppercase; background: #f0f0f0; padding: 10px; border: 1px solid #ddd; }

        /* DADOS */
        .meta-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; font-size: 12px; }
        .box { border: 1px solid #ccc; padding: 10px; border-radius: 4px; }
        .box-title { font-weight: bold; font-size: 10px; color: #666; text-transform: uppercase; margin-bottom: 5px; border-bottom: 1px solid #eee; }

        /* INPUTS EDITÁVEIS */
        .input-editable { border: none; border-bottom: 1px dashed #999; font-family: inherit; font-size: inherit; width: 100%; background: transparent; font-weight: bold; text-transform: uppercase; }
        .input-pedido { width: 80px; text-align: right; }

        /* TABELA */
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 11px; }
        th { background: #000; color: #fff; padding: 6px; text-align: left; text-transform: uppercase; }
        td { border-bottom: 1px solid #ddd; padding: 6px; }
        .col-val { text-align: right; font-weight: bold; }

        /* TOTAIS */
        .totals-area { display: flex; justify-content: flex-end; }
        .totals-box { width: 250px; text-align: right; font-size: 12px; }
        .t-row { display: flex; justify-content: space-between; padding: 2px 0; }
        .t-total { font-size: 16px; font-weight: 800; border-top: 2px solid #000; margin-top: 5px; padding-top: 5px; }

        /* CONTRATO EDITÁVEL */
        .legal-terms { margin-top: 30px; font-size: 9px; text-align: justify; color: #333; border: 1px solid transparent; padding: 5px; line-height: 1.4; outline: none; }
        .legal-terms:hover { border: 1px dashed #ccc; background: #fffde7; cursor: text; } /* Mostra que é editável */

        .signatures { margin-top: 50px; display: flex; justify-content: space-between; padding: 0 30px; }
        .sig-line { width: 40%; border-top: 1px solid #000; text-align: center; font-size: 10px; padding-top: 5px; text-transform: uppercase; }

        /* ORÇAMENTO SUAVE */
        .orcamento-msg { display: none; margin-top: 40px; text-align: center; font-size: 12px; color: #555; border-top: 1px solid #ddd; padding-top: 10px; }

        /* RODAPÉ VERTICE */
        .system-footer { position: absolute; bottom: 5mm; left: 0; width: 100%; text-align: center; font-size: 8px; color: #ccc; text-transform: uppercase; letter-spacing: 2px; }

        @media print {
            body { background: #fff; padding: 0; }
            .page { box-shadow: none; width: 100%; height: 100%; padding: 15mm; margin: 0; }
            .screen-btns { display: none; }
            .input-editable { border-bottom: none; }
            .legal-terms:hover { background: transparent; border: none; }
        }
    </style>
</head>
<body>

    <div class="screen-btns">
        <a href="#" onclick="window.close()" class="btn btn-close">FECHAR</a>
        <a href="#" onclick="window.print()" class="btn btn-print">IMPRIMIR / PDF</a>
    </div>

    <div class="page">
        <div class="header">
            <div class="logo-area">
                <img src="logo.png" alt="LM IMPORTS" onerror="this.style.display='none'; document.getElementById('logo-txt').style.display='block'">
                <h1 id="logo-txt" style="display:none; margin:0;">LM IMPORTS</h1>
            </div>
            <div class="company-info">
                <h2>LM IMPORTS</h2>
                <p>CNPJ: 00.000.000/0001-00</p>
                <p>Rua Exemplo, 123 - Centro</p>
                <p>Tel/WhatsApp: (11) 99999-9999</p>
                <p>Instagram: @lmimports</p>
            </div>
        </div>

        <div class="doc-title" id="titulo-doc">RECIBO DE VENDA</div>

        <div class="meta-grid">
            <div class="box">
                <div class="box-title">CLIENTE</div>
                <div id="cli-nome" style="font-weight:bold; text-transform:uppercase;">NOME</div>
                <div id="cli-cpf">CPF: ---</div>
                <div id="cli-tel">Tel: ---</div>
                <div id="cli-end">End: ---</div>
            </div>
            <div class="box">
                <div class="box-title">PEDIDO</div>
                <div class="t-row"><span>Nº PEDIDO:</span> <input type="text" id="ped-num" class="input-editable input-pedido" value="0000"></div>
                <div class="t-row"><span>DATA:</span> <span id="ped-data">--/--/----</span></div>
                <div class="t-row" style="margin-top:10px;"><span>VENDEDOR:</span> <input type="text" id="ped-vend" class="input-editable" value="VENDEDOR" style="text-align:right;"></div>
            </div>
        </div>

        <table>
            <thead><tr><th>PRODUTO / SERVIÇO</th><th>DETALHES</th><th class="col-val">VALOR</th></tr></thead>
            <tbody id="lista-itens"></tbody>
        </table>

        <div class="totals-area">
            <div class="totals-box">
                <div class="t-row" style="color:#666;">SUBTOTAL: <span id="val-sub">R$ ...</span></div>
                <div class="t-row" style="color:red;">DESCONTO: <span id="val-desc">R$ 0,00</span></div>
                <div class="t-row" style="font-size:10px;">TAXAS: <span id="val-taxa">R$ 0,00</span></div>
                <div class="t-row t-total">TOTAL: <span id="val-total">R$ 0,00</span></div>
                <div style="margin-top:5px; font-size:10px; font-weight:bold;" id="txt-pgto">Pagamento: Pix</div>
            </div>
        </div>

        <div id="area-contrato">
            <div class="legal-terms" contenteditable="true" title="Clique para editar">
                <strong>TERMOS DE GARANTIA E CONDIÇÕES</strong><br>
                1. A LM Imports oferece garantia de 90 dias para defeitos de fabricação (Art. 26 CDC).<br>
                2. A garantia <strong>NÃO COBRE:</strong> Danos por líquidos, quedas, mau uso, telas quebradas ou violação de selos.<br>
                3. Trocas exigem as mesmas condições estéticas da venda.<br>
                4. O cliente declara ter testado todas as funções (câmeras, face ID, áudio, rede) e estar ciente de que é um produto seminovo (se aplicável).
            </div>
            <div class="signatures">
                <div class="sig-line">LM IMPORTS</div>
                <div class="sig-line"><span id="sig-cli">CLIENTE</span></div>
            </div>
        </div>

        <div id="area-orcamento" class="orcamento-msg">
            <strong>ESTE DOCUMENTO É UM ORÇAMENTO</strong><br>
            Validade: 10 Dias • Sujeito a disponibilidade de estoque e alteração de valores.
        </div>

        <div class="system-footer">VÉRTICE BI CORE • RODRIGO N CARVALHO 2026</div>
    </div>

    <script>
        const dados = JSON.parse(localStorage.getItem('dadosRecibo'));
        const usuarioLogado = localStorage.getItem('usuarioLogado') || "VENDEDOR";
        document.getElementById('ped-vend').value = usuarioLogado.toUpperCase();

        if(dados) {
            // TÍTULO CORRETO
            let titulo = "RECIBO DE VENDA";
            if(dados.isOrcamento) titulo = "ORÇAMENTO";
            
            document.getElementById('titulo-doc').innerText = titulo;
            document.getElementById('ped-num').value = dados.numeroPedido; // Input
            document.getElementById('ped-data').innerText = dados.data;
            document.getElementById('cli-nome').innerText = dados.cliente;
            document.getElementById('cli-cpf').innerText = "CPF: " + dados.cpf;
            document.getElementById('cli-tel').innerText = "Tel: " + dados.tel;
            document.getElementById('cli-end').innerText = dados.endereco;
            document.getElementById('sig-cli').innerText = dados.cliente;

            const tbody = document.getElementById('lista-itens');
            dados.itens.forEach(i => {
                let valor = parseFloat(i.preco);
                let nome = i.nome;
                if(i.isBrinde) { valor = 0; nome += " (BRINDE)"; }
                tbody.innerHTML += `<tr><td>${nome}</td><td>${i.desc}</td><td class="col-val">${valor.toLocaleString('pt-br',{style:'currency', currency:'BRL'})}</td></tr>`;
            });

            document.getElementById('val-desc').innerText = "- " + dados.descontoManual.toLocaleString('pt-br',{style:'currency', currency:'BRL'});
            document.getElementById('val-taxa').innerText = "+ " + (dados.taxaMaquininha||0).toLocaleString('pt-br',{style:'currency', currency:'BRL'});
            document.getElementById('val-total').innerText = dados.total.toLocaleString('pt-br',{style:'currency', currency:'BRL'});
            document.getElementById('txt-pgto').innerText = `Forma: ${dados.pagamento} ${dados.textoParcelas||''}`;

            // ESCONDE/MOSTRA CONTRATO
            if(dados.isOrcamento) {
                document.getElementById('area-contrato').style.display = 'none';
                document.getElementById('area-orcamento').style.display = 'block';
            } else {
                document.getElementById('area-contrato').style.display = 'block';
                document.getElementById('area-orcamento').style.display = 'none';
            }

            // AUTO PRINT SÓ SE NÃO FOR PREVIEW
            if(dados.autoPrint) {
                setTimeout(() => window.print(), 800);
            }
        }
    </script>
</body>
</html>
