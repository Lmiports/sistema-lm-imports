<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recibo / Orçamento</title>
    <style>
        /* ESTILO PARA IMPRESSORA TÉRMICA (80mm ou 58mm) */
        body { font-family: 'Courier New', Courier, monospace; margin: 0; padding: 10px; color: #000; font-size: 12px; max-width: 300px; /* Largura típica térmica */ margin: 0 auto; }
        
        .header { text-align: center; border-bottom: 1px dashed #000; padding-bottom: 10px; margin-bottom: 10px; }
        .logo { font-size: 20px; font-weight: bold; margin-bottom: 5px; }
        .sub-header { font-size: 10px; margin-bottom: 15px; }
        
        .info-row { display: flex; justify-content: space-between; margin-bottom: 3px; font-size: 11px; }
        
        .table-items { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 11px; }
        .table-items th { text-align: left; border-bottom: 1px solid #000; padding: 2px 0; }
        .table-items td { padding: 4px 0; border-bottom: 1px dashed #ccc; vertical-align: top; }
        .td-qtd { width: 30px; text-align: center; }
        .td-valor { text-align: right; white-space: nowrap; }
        
        .totals { margin-top: 15px; border-top: 1px solid #000; padding-top: 5px; font-size: 12px; }
        .total-row { display: flex; justify-content: space-between; margin-bottom: 3px; }
        .grand-total { font-size: 16px; font-weight: bold; margin-top: 5px; }
        
        .footer { text-align: center; margin-top: 20px; font-size: 10px; border-top: 1px dashed #000; padding-top: 10px; }
        
        .troca-item { color: #555; font-style: italic; }

        @media print {
            .no-print { display: none; }
            body { max-width: 100%; }
        }
    </style>
</head>
<body>

    <button onclick="window.print()" class="no-print" style="width:100%; padding:10px; background:#000; color:#fff; font-weight:bold; margin-bottom:10px; cursor:pointer;">IMPRIMIR</button>

    <div class="header">
        <div class="logo">LM IMPORTS</div>
        <div style="font-size:10px;">Rua Exemplo, 123 - Centro</div>
        <div style="font-size:10px;">(11) 99999-9999</div>
        <div style="font-size:10px; margin-top:5px;" id="lbl-tipo-doc">RECIBO DE VENDA</div>
        <div style="font-size:12px; font-weight:bold;" id="lbl-num-pedido">#0000</div>
    </div>

    <div class="sub-header">
        <div class="info-row"><span>Data:</span> <span id="lbl-data"></span></div>
        <div class="info-row"><span>Cliente:</span> <span id="lbl-cliente" style="font-weight:bold;"></span></div>
        <div class="info-row" id="row-cpf"><span>CPF:</span> <span id="lbl-cpf"></span></div>
    </div>

    <table class="table-items">
        <thead>
            <tr>
                <th class="td-qtd">QTD</th>
                <th>ITEM</th>
                <th class="td-valor">TOTAL</th>
            </tr>
        </thead>
        <tbody id="lista-itens">
            </tbody>
    </table>

    <div class="totals">
        <div class="total-row" id="row-desconto" style="display:none;">
            <span>Desconto:</span>
            <span id="lbl-desconto">R$ 0,00</span>
        </div>
        <div class="total-row grand-total">
            <span>TOTAL:</span>
            <span id="lbl-total">R$ 0,00</span>
        </div>
        <div style="text-align:right; font-size:11px; margin-top:5px;">
            Pagamento: <span id="lbl-pagamento" style="font-weight:bold;"></span>
        </div>
        <div id="lbl-parcelas" style="text-align:right; font-size:10px; margin-top:2px;"></div>
    </div>

    <div class="footer">
        <p>Obrigado pela preferência!</p>
        <p>Garantia de 90 dias (Lei 8.078/90)</p>
        <p style="margin-top:10px; font-size:9px;">Sistema VÉRTICE BI CORE</p>
    </div>

    <script>
        window.onload = function() {
            const dadosStr = localStorage.getItem('dadosRecibo');
            if(!dadosStr) {
                document.body.innerHTML = "<h3>Erro: Nenhum dado de venda encontrado.</h3>";
                return;
            }

            const dados = JSON.parse(dadosStr);

            document.getElementById('lbl-tipo-doc').innerText = dados.titulo || "RECIBO";
            document.getElementById('lbl-num-pedido').innerText = "#" + (dados.numeroPedido || "---");
            document.getElementById('lbl-data').innerText = dados.data;
            document.getElementById('lbl-cliente').innerText = dados.cliente;
            
            if(dados.cpf) document.getElementById('lbl-cpf').innerText = dados.cpf;
            else document.getElementById('row-cpf').style.display = 'none';

            const tbody = document.getElementById('lista-itens');
            tbody.innerHTML = "";

            dados.itens.forEach(item => {
                const tr = document.createElement('tr');
                
                let desc = item.nome;
                if(item.desc) desc += " " + item.desc; // Adiciona cor/detalhe
                if(item.isBrinde) desc += " (BRINDE)";
                if(item.isTroca) {
                    tr.className = "troca-item";
                    desc = item.nome; // Nome já vem com "TROCA:"
                }

                // Preço Total da Linha (Unitário x Qtd)
                let valTotalItem = item.total || (item.preco * (item.qtd || 1));
                
                // Formatação
                let valTexto = valTotalItem.toLocaleString('pt-br',{style:'currency', currency:'BRL'});
                if(item.isBrinde) valTexto = "Grátis";

                tr.innerHTML = `
                    <td class="td-qtd">${item.qtd || 1}</td>
                    <td>${desc}</td>
                    <td class="td-valor">${valTexto}</td>
                `;
                tbody.appendChild(tr);
            });

            // Totais
            if(dados.descontoManual > 0) {
                document.getElementById('row-desconto').style.display = 'flex';
                document.getElementById('lbl-desconto').innerText = "- " + dados.descontoManual.toLocaleString('pt-br',{style:'currency', currency:'BRL'});
            }

            document.getElementById('lbl-total').innerText = dados.total.toLocaleString('pt-br',{style:'currency', currency:'BRL'});
            document.getElementById('lbl-pagamento').innerText = dados.pagamento;
            
            if(dados.textoParcelas) {
                document.getElementById('lbl-parcelas').innerText = dados.textoParcelas;
            }

            // Auto Print se for Venda
            if(dados.autoPrint) {
                setTimeout(() => window.print(), 500);
            }
        };
    </script>
</body>
</html>
