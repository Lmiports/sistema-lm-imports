<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Imprimir Recibo</title>
    <style>
        body { font-family: 'Courier New', Courier, monospace; margin: 0; padding: 20px; color: #000; }
        .container { max-width: 800px; margin: 0 auto; border: 1px solid #000; padding: 20px; }
        
        .header { text-align: center; border-bottom: 2px dashed #000; padding-bottom: 10px; margin-bottom: 20px; }
        .header h1 { margin: 0; font-size: 24px; text-transform: uppercase; }
        .logo-img { max-height: 60px; margin-bottom: 5px; }

        .info-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .box { border: 1px solid #000; padding: 10px; margin-bottom: 15px; }
        .box h3 { margin: 0 0 5px 0; font-size: 14px; text-transform: uppercase; border-bottom: 1px solid #000; }

        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; font-size: 12px; }
        th, td { border: 1px solid #000; padding: 5px; text-align: left; }
        th { background: #eee; }
        .text-right { text-align: right; }

        .totals { display: flex; flex-direction: column; align-items: flex-end; margin-bottom: 20px; }
        .total-row { display: flex; justify-content: space-between; width: 250px; font-weight: bold; font-size: 14px; }
        
        .legal-text { font-size: 10px; text-align: justify; margin-top: 20px; border-top: 1px solid #000; padding-top: 10px; line-height: 1.4; }
        
        .signatures { display: flex; justify-content: space-between; margin-top: 50px; }
        .sig-line { width: 45%; border-top: 1px solid #000; text-align: center; font-size: 12px; padding-top: 5px; }

        .watermark { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); font-size: 100px; color: rgba(0,0,0,0.05); z-index: -1; pointer-events: none; }

        /* Esconde botões na impressão */
        @media print { .no-print { display: none; } }
        .no-print { position: fixed; top: 20px; right: 20px; background: #000; color: #fff; padding: 10px 20px; cursor: pointer; border-radius: 5px; text-decoration: none; }
    </style>
</head>
<body>

    <a href="#" onclick="window.print()" class="no-print">IMPRIMIR</a>

    <div class="container">
        <div class="header">
            <h1 id="titulo-doc">RECIBO DE VENDA</h1>
            <p>LM IMPORTS • CNPJ: 00.000.000/0001-00</p>
            <p>Rua Exemplo, 123 - Centro - Cidade/UF</p>
            <p>Tel/Zap: (11) 99999-9999</p>
        </div>

        <div class="info-row">
            <span><strong>PEDIDO Nº:</strong> <span id="num-pedido">0000</span></span>
            <span><strong>DATA:</strong> <span id="data-pedido">01/01/2026</span></span>
        </div>

        <div class="box">
            <h3>Dados do Cliente</h3>
            <div id="dados-cliente">Carregando...</div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>PRODUTO / SERVIÇO</th>
                    <th>DETALHES</th>
                    <th class="text-right">VALOR</th>
                </tr>
            </thead>
            <tbody id="lista-itens"></tbody>
        </table>

        <div class="totals">
            <div class="total-row"><span>SUBTOTAL:</span> <span id="val-sub">R$ 0,00</span></div>
            <div class="total-row"><span>DESCONTO:</span> <span id="val-desc">R$ 0,00</span></div>
            <div class="total-row" style="margin-top:5px; font-size:16px;"><span>TOTAL:</span> <span id="val-total">R$ 0,00</span></div>
            <div style="font-size:11px; margin-top:5px;" id="forma-pgto"></div>
        </div>

        <div id="area-contrato">
            <div class="legal-text">
                <strong>TERMOS DE GARANTIA E CONTRATO DE VENDA</strong><br>
                1. A LM Imports oferece garantia de 90 (noventa) dias para defeitos de fabricação, conforme Art. 26 do CDC.<br>
                2. A garantia NÃO cobre: danos causados por líquidos, quedas, mau uso, ou violação do selo de garantia.<br>
                3. Em caso de troca, o produto deve estar nas mesmas condições de venda.<br>
                4. O cliente declara ter testado o aparelho e verificado que todas as funções (câmera, face ID, áudio, rede) estão funcionais no ato da compra.<br>
                5. Aparelhos usados podem conter marcas de uso que não afetam o funcionamento.
            </div>

            <div class="signatures">
                <div class="sig-line">LM IMPORTS<br>Vendedor</div>
                <div class="sig-line"><span id="nome-cli-sig">CLIENTE</span><br>Comprador</div>
            </div>
        </div>

        <div id="area-orcamento" style="display:none; text-align:center; margin-top:50px; border:2px solid #000; padding:20px;">
            <h3>ORÇAMENTO VÁLIDO POR 5 DIAS</h3>
            <p>Este documento não garante reserva de estoque.</p>
            <p>Valores sujeitos a alteração sem aviso prévio.</p>
        </div>

    </div>

    <script>
        // Pega os dados do LocalStorage
        const dados = JSON.parse(localStorage.getItem('dadosRecibo'));

        if(dados) {
            // Preenche dados básicos
            document.getElementById('num-pedido').innerText = dados.numeroPedido;
            document.getElementById('data-pedido').innerText = dados.data;
            document.getElementById('dados-cliente').innerHTML = `
                ${dados.cliente} <br>
                CPF: ${dados.cpf} | Tel: ${dados.tel} <br>
                ${dados.endereco}
            `;
            document.getElementById('nome-cli-sig').innerText = dados.cliente;

            // Preenche Itens
            const tbody = document.getElementById('lista-itens');
            let subtotal = 0;
            dados.itens.forEach(item => {
                let nome = item.nome;
                let valor = parseFloat(item.preco);
                if(item.isBrinde) { valor = 0; nome += " (BRINDE)"; }
                if(item.isTroca) { subtotal += valor; } // Se for troca, é negativo, abate
                else { subtotal += valor; }

                tbody.innerHTML += `
                    <tr>
                        <td>${nome}</td>
                        <td>${item.desc}</td>
                        <td class="text-right">${valor.toLocaleString('pt-br',{style:'currency', currency:'BRL'})}</td>
                    </tr>
                `;
            });

            // Totals
            document.getElementById('val-sub').innerText = subtotal.toLocaleString('pt-br',{style:'currency', currency:'BRL'});
            document.getElementById('val-desc').innerText = "- " + dados.descontoManual.toLocaleString('pt-br',{style:'currency', currency:'BRL'});
            document.getElementById('val-total').innerText = dados.total.toLocaleString('pt-br',{style:'currency', currency:'BRL'});
            document.getElementById('forma-pgto').innerText = `Forma de Pagamento: ${dados.pagamento} ${dados.textoParcelas || ''}`;

            // LÓGICA DE ORÇAMENTO VS VENDA
            if (dados.isOrcamento) {
                // MODO ORÇAMENTO
                document.getElementById('titulo-doc').innerText = "ORÇAMENTO";
                document.getElementById('area-contrato').style.display = 'none'; // Esconde contrato
                document.getElementById('area-orcamento').style.display = 'block'; // Mostra aviso de orçamento
                
                // Marca d'água
                const bg = document.createElement('div');
                bg.className = 'watermark';
                bg.innerText = "ORÇAMENTO";
                document.body.appendChild(bg);
            } else {
                // MODO VENDA (Padrão)
                document.getElementById('titulo-doc').innerText = "RECIBO DE VENDA";
            }
        } else {
            document.body.innerHTML = "<h1 style='text-align:center; margin-top:50px;'>Nenhum dado encontrado para impressão.</h1>";
        }
        
        // Imprime automático ao abrir
        setTimeout(() => window.print(), 500);
    </script>
</body>
</html>
