<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Documento | Vértice BI</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');

        /* TIRA CABEÇALHO E RODAPÉ DO NAVEGADOR (URL, DATA, ETC) */
        @page {
            size: A4;
            margin: 0; 
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background: #eee; 
            margin: 0; 
            padding: 20px; 
            display: flex; 
            justify-content: center; 
        }

        /* FOLHA A4 */
        .page {
            background: #fff;
            width: 210mm;
            min-height: 297mm;
            padding: 15mm;
            padding-bottom: 20mm;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
            box-sizing: border-box;
            margin: 0 auto;
        }

        /* RODAPÉ DO SISTEMA FIXO NA IMPRESSÃO */
        .system-footer {
            position: absolute;
            bottom: 5mm;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 8px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* CABEÇALHO */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #000;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .logo-area img {
            max-height: 120px; /* LOGO MAIOR */
            max-width: 280px;
        }
        .company-info {
            text-align: right;
            font-size: 12px;
            line-height: 1.4;
        }
        .company-info h2 { margin: 0; font-size: 20px; text-transform: uppercase; }

        /* TÍTULO */
        .doc-title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0;
            text-transform: uppercase;
            background: #f4f4f4;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .meta-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
            font-size: 13px;
        }
        .box {
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 4px;
        }
        .box-title {
            font-weight: bold;
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 5px;
            border-bottom: 1px solid #eee;
            padding-bottom: 2px;
        }

        /* INPUTS EDITÁVEIS (INVISIBLE MODE) */
        .input-editable {
            border: none;
            border-bottom: 1px dashed #999;
            font-family: inherit;
            font-size: inherit;
            background: transparent;
            color: #000;
            font-weight: bold;
            padding: 0;
            margin: 0;
        }
        .input-pedido { width: 100px; }
        .input-vendedor { width: 100%; }

        /* TABELA */
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 12px; }
        th { background: #000; color: #fff; padding: 8px; text-align: left; text-transform: uppercase; }
        td { border-bottom: 1px solid #ddd; padding: 8px; }
        .col-valor { text-align: right; white-space: nowrap; font-weight: bold; }
        
        /* TOTAIS */
        .totals-area { display: flex; justify-content: flex-end; }
        .totals-box { width: 250px; text-align: right; }
        .t-row { display: flex; justify-content: space-between; padding: 3px 0; font-size: 13px; }
        .t-total { font-size: 18px; font-weight: bold; border-top: 2px solid #000; margin-top: 5px; padding-top: 5px; }

        /* CONTRATO EDITÁVEL */
        .legal-terms {
            margin-top: 40px;
            font-size: 10px;
            text-align: justify;
            color: #333;
            border: 1px solid #eee;
            padding: 10px;
            background: #fafafa;
            outline: none; /* Remove borda azul ao clicar */
            cursor: text;
        }
        /* Efeito ao passar o mouse para mostrar que é editável */
        .legal-terms:hover { background: #fffde7; border: 1px dashed #ccc; }
        
        .signatures {
            margin-top: 50px;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
        }
        .sig-line {
            width: 40%;
            border-top: 1px solid #000;
            text-align: center;
            font-size: 11px;
            padding-top: 5px;
        }

        /* ORÇAMENTO */
        .orcamento-alert {
            display: none;
            margin-top: 50px;
            text-align: center;
            border: 2px dashed #000;
            padding: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        /* BOTÕES DE TELA */
        .screen-btns { position: fixed; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 999; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; text-decoration: none; color: #fff; }
        .btn-print { background: #000; }
        .btn-close { background: #666; }

        @media print {
            body { background: #fff; padding: 0; }
            .page { box-shadow: none; width: 100%; height: 100%; padding: 15mm; margin: 0; }
            .screen-btns { display: none; }
            .input-editable { border-bottom: none; }
            .legal-terms { background: transparent; border: none; } /* Remove fundo e borda na impressão */
        }
    </style>
</head>
<body>

    <div class="screen-btns">
        <a href="#" onclick="window.close()" class="btn btn-close">FECHAR</a>
        <a href="#" onclick="window.print()" class="btn btn-print">IMPRIMIR / SALVAR PDF</a>
    </div>

    <div class="page">
        
        <div class="header">
            <div class="logo-area">
                <img src="logo.png" alt="LM IMPORTS" onerror="this.style.display='none'; document.getElementById('logo-text').style.display='block'">
                <h1 id="logo-text" style="display:none; margin:0;">LM IMPORTS</h1>
            </div>
            <div class="company-info">
                <h2>LM IMPORTS</h2>
                <p>CNPJ: 00.000.000/0001-00</p>
                <p>Rua Exemplo, 123 - Centro</p>
                <p>Tel/WhatsApp: (11) 99999-9999</p>
                <p>Instagram: @lmimports</p>
            </div>
        </div>

        <div class="doc-title" id="titulo-doc">RECIBO DE VENDA</div>

        <div class="meta-grid">
            <div class="box">
                <div class="box-title">DADOS DO CLIENTE</div>
                <div id="cli-nome" style="font-weight:bold;">Nome do Cliente</div>
                <div id="cli-cpf">CPF: ---</div>
                <div id="cli-tel">Tel: ---</div>
                <div id="cli-end">Endereço: ---</div>
            </div>
            <div class="box">
                <div class="box-title">DADOS DO PEDIDO</div>
                <div class="t-row">
                    <span>Nº Pedido:</span> 
                    <input type="text" id="ped-num-input" class="input-editable input-pedido" value="0000">
                </div>
                <div class="t-row"><span>Data:</span> <span id="ped-data">--/--/----</span></div>
                <div class="t-row" style="margin-top:10px;">
                    <span>Vendedor:</span> 
                    <input type="text" id="vendedor-input" class="input-editable input-vendedor" value="Vendedor">
                </div>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>PRODUTO / SERVIÇO</th>
                    <th>DETALHES</th>
                    <th class="col-valor">VALOR</th>
                </tr>
            </thead>
            <tbody id="lista-itens"></tbody>
        </table>

        <div class="totals-area">
            <div class="totals-box">
                <div class="t-row" style="color:#666;">SUBTOTAL: <span id="val-sub">R$ ...</span></div>
                <div class="t-row" style="color:red;">DESCONTO: <span id="val-desc">R$ 0,00</span></div>
                <div class="t-row" style="font-size:11px;">TAXAS/JUROS: <span id="val-taxa">R$ 0,00</span></div>
                <div class="t-row t-total">TOTAL: <span id="val-total">R$ 0,00</span></div>
                <div style="margin-top:10px; font-size:11px; font-weight:bold;" id="txt-pagamento">Pagamento: Pix</div>
            </div>
        </div>

        <div id="area-contrato">
            <div class="legal-terms" contenteditable="true">
                <strong>TERMOS DE GARANTIA E CONDIÇÕES (EDITÁVEL - CLIQUE PARA ALTERAR)</strong><br><br>
                1. A LM Imports oferece garantia de 90 (noventa) dias para defeitos de fabricação, conforme Art. 26 do CDC.<br>
                2. A garantia <strong>NÃO COBRE:</strong> Danos causados por líquidos, quedas, mau uso, telas quebradas ou violação do selo de garantia.<br>
                3. Em caso de troca, o produto deve estar nas mesmas condições estéticas do ato da venda.<br>
                4. O cliente declara ter testado todas as funções do aparelho e estar ciente de que se trata de um produto seminovo (se aplicável).
            </div>

            <div class="signatures">
                <div class="sig-line">LM IMPORTS<br>Vendedor</div>
                <div class="sig-line"><span id="sig-cli-nome">CLIENTE</span><br>Comprador</div>
            </div>
        </div>

        <div id="area-orcamento" class="orcamento-alert">
            <p>ESTE DOCUMENTO É UM ORÇAMENTO</p>
            <p style="font-weight:normal; font-size:12px;">Validade: 10 Dias • Não garante reserva de estoque • Sujeito a alteração de valores.</p>
        </div>

        <div class="system-footer">
            VÉRTICE BI CORE • GESTÃO INTELIGENTE
        </div>

    </div>

    <script>
        const dados = JSON.parse(localStorage.getItem('dadosRecibo'));
        const usuarioLogado = localStorage.getItem('usuarioLogado') || "Vendedor";
        document.getElementById('vendedor-input').value = usuarioLogado;

        if(dados) {
            // LÓGICA DO TÍTULO: Se for pré-visualização, mostra RECIBO DE VENDA mas sem validade
            let tituloFinal = dados.titulo;
            if(!tituloFinal || tituloFinal === "UNDEFINED") {
                tituloFinal = dados.isOrcamento ? "ORÇAMENTO" : "RECIBO DE VENDA";
            }
            document.getElementById('titulo-doc').innerText = tituloFinal;
            
            document.getElementById('ped-num-input').value = dados.numeroPedido;
            document.getElementById('ped-data').innerText = dados.data;
            document.getElementById('cli-nome').innerText = dados.cliente;
            document.getElementById('cli-cpf').innerText = "CPF: " + dados.cpf;
            document.getElementById('cli-tel').innerText = "Tel: " + dados.tel;
            document.getElementById('cli-end').innerText = dados.endereco;
            document.getElementById('sig-cli-nome').innerText = dados.cliente;

            const tbody = document.getElementById('lista-itens');
            dados.itens.forEach(item => {
                let nome = item.nome;
                let valor = parseFloat(item.preco);
                if(item.isBrinde) { valor = 0; nome += " (BRINDE)"; }
                tbody.innerHTML += `<tr><td>${nome}</td><td>${item.desc}</td><td class="col-valor">${valor.toLocaleString('pt-br',{style:'currency', currency:'BRL'})}</td></tr>`;
            });

            document.getElementById('val-desc').innerText = "- " + dados.descontoManual.toLocaleString('pt-br',{style:'currency', currency:'BRL'});
            let taxas = dados.taxaMaquininha || 0;
            document.getElementById('val-taxa').innerText = "+ " + taxas.toLocaleString('pt-br',{style:'currency', currency:'BRL'});
            document.getElementById('val-total').innerText = dados.total.toLocaleString('pt-br',{style:'currency', currency:'BRL'});
            document.getElementById('txt-pagamento').innerText = `Forma de Pagamento: ${dados.pagamento} ${dados.textoParcelas || ''}`;

            if (dados.isOrcamento) {
                document.getElementById('area-contrato').style.display = 'none';
                document.getElementById('area-orcamento').style.display = 'block';
            } else {
                document.getElementById('area-contrato').style.display = 'block';
                document.getElementById('area-orcamento').style.display = 'none';
            }
        }

        // AUTO IMPRESSÃO COM PEQUENO DELAY PARA CARREGAR A IMAGEM
        setTimeout(() => {
            window.print();
        }, 800);
    </script>
</body>
</html>
