<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDV - Vendas e Trocas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    
    <style>
        :root {
            --bg: #020617; --card: #0f172a; --accent: #00e0ff; --text: #f8fafc;
            --border: rgba(255, 255, 255, 0.1); --success: #22c55e; --danger: #ef4444; --warning: #eab308;
        }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; height: 100vh; display: flex; flex-direction: column; box-sizing: border-box; }
        
        /* HEADER */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
        .header h2 { margin: 0; color: var(--accent); letter-spacing: 2px; }
        .btn-voltar { color: #fff; text-decoration: none; font-size: 20px; }

        /* GRID */
        .main-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; flex: 1; overflow: hidden; }

        /* PRODUTOS */
        .products-section { display: flex; flex-direction: column; gap: 15px; overflow-y: hidden; }
        .search-box { display: flex; gap: 10px; }
        .search-box input, .search-box select { width: 100%; padding: 12px; background: var(--card); border: 1px solid var(--border); color: #fff; border-radius: 8px; outline: none; }
        .products-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; overflow-y: auto; padding-right: 5px; }
        
        .product-card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 15px; cursor: pointer; transition: 0.2s; position: relative; display: flex; flex-direction: column; justify-content: space-between; }
        .product-card:hover { border-color: var(--accent); transform: translateY(-3px); }
        .prod-cat-tag { font-size: 10px; text-transform: uppercase; background: rgba(0, 224, 255, 0.1); color: var(--accent); padding: 4px 8px; border-radius: 4px; width: fit-content; margin-bottom: 5px; font-weight: bold; }
        .prod-name { font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        .prod-detail { font-size: 11px; color: #94a3b8; margin-bottom: 5px; }
        .prod-price { color: var(--success); font-weight: bold; font-size: 16px; margin-top: auto; }

        /* CARRINHO */
        .cart-section { background: var(--card); border-radius: 15px; border: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; }
        .client-area { margin-bottom: 15px; }
        .client-row { display: flex; gap: 5px; }
        .client-input-wrapper { width: 100%; position: relative; }
        .client-row input[list] { width: 100%; padding: 10px; background: #1e293b; border: 1px solid var(--border); color: #fff; border-radius: 5px; box-sizing: border-box; }
        .btn-add-client { background: var(--success); color: #000; border: none; width: 40px; border-radius: 5px; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; }
        
        .cart-items { flex: 1; overflow-y: auto; margin-bottom: 15px; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); padding: 10px 0; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 5px; margin-bottom: 8px; }
        .item-info div { font-size: 13px; font-weight: bold; }
        .item-info small { font-size: 10px; color: #94a3b8; display: block; }
        .btn-remove { color: var(--danger); cursor: pointer; padding: 5px; }

        /* TROCA & TOTAIS */
        .trade-in-box { background: rgba(234, 179, 8, 0.1); border: 1px solid var(--warning); padding: 10px; border-radius: 8px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .trade-in-text { font-size: 12px; color: var(--warning); }
        .totals { margin-bottom: 15px; font-size: 14px; }
        .row { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .total-final { font-size: 24px; font-weight: 900; color: var(--success); border-top: 1px solid var(--border); padding-top: 10px; }

        /* BOTÃ•ES */
        .btn-finalizar { background: var(--success); color: #000; padding: 15px; width: 100%; border: none; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; }
        .btn-troca { background: transparent; border: 1px solid var(--warning); color: var(--warning); padding: 10px; width: 100%; border-radius: 8px; margin-bottom: 10px; cursor: pointer; }
        .btn-recibo { background: #eab308; color: #000; padding: 15px; width: 100%; border: none; border-radius: 8px; font-weight: bold; margin-top: 10px; cursor: pointer; }

        /* MODAIS */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal { background: var(--card); padding: 25px; border-radius: 15px; width: 400px; max-width: 90%; max-height: 90vh; overflow-y: auto; border: 1px solid var(--border); }
        .modal input, .modal select { width: 100%; padding: 10px; margin: 5px 0; background: #1e293b; border: 1px solid var(--border); color: #fff; border-radius: 5px; box-sizing: border-box; }
        .modal h3 { margin-top: 0; color: var(--accent); }
        .modal-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-cancel { flex: 1; padding: 10px; background: #334155; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
        .btn-confirm { flex: 1; padding: 10px; background: var(--success); color: #000; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }

        @media (max-width: 768px) { .main-grid { grid-template-columns: 1fr; overflow-y: auto; } .cart-section { margin-top: 20px; } body { height: auto; } }
    </style>
</head>
<body>

    <div class="header">
        <a href="index.html" class="btn-voltar"><i class="fas fa-arrow-left"></i></a>
        <h2>PDV | VENDAS</h2>
        <div></div>
    </div>

    <div class="main-grid">
        
        <div class="products-section">
            <div class="search-box">
                <input type="text" id="busca" placeholder="Buscar produto..." onkeyup="filtrarProdutos()">
                <select id="filtro-cat" onchange="filtrarProdutos()" style="width: 150px;">
                    <option value="">Todas</option>
                    <option value="celular">ðŸ“± Celulares</option>
                    <option value="roupa">ðŸ‘• Roupas</option>
                    <option value="perfume">ðŸŒ¸ Perfumes</option>
                    <option value="acessorio">ðŸŽ§ AcessÃ³rios</option>
                </select>
            </div>

            <div class="products-list" id="lista-produtos">
                <div style="padding:20px; text-align:center; color:#888;">Carregando Estoque...</div>
            </div>
        </div>

        <div class="cart-section">
            <div class="client-area">
                <label style="font-size: 12px; color: #94a3b8;">Cliente (Busca por Nome, CPF ou Telefone):</label>
                <div class="client-row">
                    <div class="client-input-wrapper">
                        <input list="lista-clientes-db" id="cliente-input" placeholder="Digite para buscar..." autocomplete="off">
                        <datalist id="lista-clientes-db">
                            </datalist>
                    </div>
                    <button class="btn-add-client" onclick="abrirModalCliente()" title="Novo Cliente">+</button>
                </div>
            </div>

            <div class="cart-items" id="carrinho-lista">
                <div style="text-align: center; color: #64748b; margin-top: 20px;">Carrinho vazio</div>
            </div>

            <div id="lista-trocas"></div>

            <div class="totals">
                <div class="row"><span>Subtotal:</span><span id="valor-subtotal">R$ 0,00</span></div>
                <div class="row" style="color: var(--warning);"><span>Troca/Desc:</span><span id="valor-desconto">- R$ 0,00</span></div>
                <div class="row total-final"><span>TOTAL:</span><span id="valor-total">R$ 0,00</span></div>
            </div>

            <div style="margin-bottom: 10px;">
                <label style="font-size: 12px;">Pagamento:</label>
                <select id="forma-pagamento" style="width: 100%; padding: 8px; background: #1e293b; color: #fff; border: 1px solid var(--border); border-radius: 5px;">
                    </select>
            </div>

            <button class="btn-troca" onclick="abrirModalTroca()"><i class="fas fa-exchange-alt"></i> Entrada de Troca</button>
            <button class="btn-finalizar" onclick="finalizarVenda()"><i class="fas fa-check"></i> FINALIZAR VENDA</button>
            <button class="btn-recibo" onclick="gerarRecibo()"><i class="fas fa-file-contract"></i> RECIBO & CONTRATO</button>
        </div>
    </div>

    <div class="modal-overlay" id="modal-troca">
        <div class="modal" style="border-color: var(--warning);">
            <h3 style="color: var(--warning);">Entrada de Troca</h3>
            
            <label style="font-size: 11px; color: #999;">Modelo (Lista Gerenciada):</label>
            <input list="dl-modelos-list" id="troca-modelo" placeholder="Digite ou selecione...">
            <datalist id="dl-modelos-list"></datalist>

            <div class="modal-grid">
                <div>
                    <label style="font-size: 11px; color: #999;">MemÃ³ria:</label>
                    <select id="troca-gb">
                        <option value="">Selecione...</option>
                        <option value="64GB">64GB</option>
                        <option value="128GB">128GB</option>
                        <option value="256GB">256GB</option>
                        <option value="512GB">512GB</option>
                        <option value="1TB">1TB</option>
                        <option value="Outro">Outro</option>
                    </select>
                </div>
                <div>
                    <label style="font-size: 11px; color: #999;">Cor (Lista Gerenciada):</label>
                    <input list="dl-cores-list" id="troca-cor" placeholder="Selecione...">
                    <datalist id="dl-cores-list"></datalist>
                </div>
            </div>
            
            <label style="font-size: 11px; color: #999;">IMEI (15 dÃ­gitos):</label>
            <input type="text" id="troca-imei" placeholder="000000000000000" maxlength="15" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 15)">
            
            <div class="modal-grid">
                <div>
                    <label style="font-size: 11px; color: #999;">Valor (R$):</label>
                    <input type="number" id="troca-valor" placeholder="0,00">
                </div>
                <div>
                    <label style="font-size: 11px; color: #999;">Bateria (%):</label>
                    <input type="number" id="troca-bateria" placeholder="100">
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button onclick="fecharModalTroca()" class="btn-cancel">Cancelar</button>
                <button onclick="confirmarTroca()" class="btn-confirm" style="background: var(--warning);">Confirmar</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-cliente">
        <div class="modal">
            <h3>Novo Cliente Completo</h3>
            <label style="font-size: 12px; color: #888;">Dados Pessoais</label>
            <input type="text" id="novo-nome" placeholder="Nome Completo (ObrigatÃ³rio)">
            <div class="modal-grid">
                <input type="text" id="novo-zap" placeholder="WhatsApp">
                <input type="text" id="novo-cpf" placeholder="CPF">
            </div>
            <input type="email" id="novo-email" placeholder="Email">

            <label style="font-size: 12px; color: #888; margin-top: 10px; display: block;">EndereÃ§o</label>
            <div class="modal-grid">
                <input type="text" id="novo-cep" placeholder="CEP" onblur="buscarCep()">
                <input type="text" id="novo-numero" placeholder="NÃºmero">
            </div>
            <input type="text" id="novo-endereco" placeholder="Rua / Avenida">
            <div class="modal-grid">
                <input type="text" id="novo-bairro" placeholder="Bairro">
                <input type="text" id="novo-cidade" placeholder="Cidade - UF">
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="fecharModalCliente()" class="btn-cancel">Cancelar</button>
                <button onclick="salvarNovoCliente()" class="btn-confirm">Salvar Cadastro</button>
            </div>
        </div>
    </div>

    <script>
        // VARIAVEIS GLOBAIS
        let dbEstoque = [];
        let dbClientes = [];
        let carrinho = [];
        let trocas = [];
        let totalVendaGlobal = 0;

        // 1. CONECTAR AO FIREBASE AO ABRIR
        window.onload = function() {
            // A. Carregar Estoque DisponÃ­vel
            db.collection("estoque").where("status", "==", "disponÃ­vel").onSnapshot(snap => {
                dbEstoque = [];
                snap.forEach(doc => {
                    dbEstoque.push({ id: doc.id, ...doc.data() });
                });
                renderizarProdutos();
            });

            // B. Carregar Clientes
            db.collection("clientes").orderBy("nome").onSnapshot(snap => {
                dbClientes = [];
                snap.forEach(doc => {
                    dbClientes.push({ id: doc.id, ...doc.data() });
                });
                renderizarDatalistClientes();
            });

            carregarOpcoesPagamento();
            carregarListasAuxiliares(); // IMPORTANTE: Carrega as listas do menu Estoque
        };

        // 2. CARREGAR LISTAS DE MODELOS E CORES (ConexÃ£o com suas Listas)
        function carregarListasAuxiliares() {
            // Lista de Modelos
            db.collection("lista_modelos_cel").orderBy("nome").onSnapshot(snap => {
                const dl = document.getElementById('dl-modelos-list');
                dl.innerHTML = "";
                snap.forEach(doc => {
                    dl.innerHTML += `<option value="${doc.data().nome}">`;
                });
            });

            // Lista de Cores
            db.collection("lista_cores_cel").orderBy("nome").onSnapshot(snap => {
                const dl = document.getElementById('dl-cores-list');
                dl.innerHTML = "";
                snap.forEach(doc => {
                    dl.innerHTML += `<option value="${doc.data().nome}">`;
                });
            });
        }

        // 3. RENDERIZAR PRODUTOS
        function renderizarProdutos() {
            const div = document.getElementById('lista-produtos');
            div.innerHTML = "";
            
            if (dbEstoque.length === 0) {
                div.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: #888; padding: 20px;">Nenhum produto disponÃ­vel no estoque.</div>';
                return;
            }

            dbEstoque.forEach(p => {
                const el = document.createElement('div');
                el.className = 'product-card';
                el.onclick = () => adicionarAoCarrinho(p);

                let cat = (p.categoria || 'outros').toLowerCase();
                let icon = 'ðŸ“¦';
                if(cat.includes('celular')) icon = 'ðŸ“±';
                if(cat.includes('roupa')) icon = 'ðŸ‘•';
                if(cat.includes('perfume')) icon = 'ðŸŒ¸';
                if(cat.includes('acessorio')) icon = 'ðŸŽ§';

                // Compatibilidade: tenta modelo ou nomeP
                let nome = p.modelo || p.nomeP || 'Produto sem nome';
                let detalhe = p.cor ? `${p.cor} ${p.gb || ''}` : '';

                el.innerHTML = `
                    <span class="prod-cat-tag">${icon} ${cat.toUpperCase()}</span>
                    <span class="prod-name">${nome}</span>
                    <span class="prod-detail">${detalhe}</span>
                    <span class="prod-price">R$ ${parseFloat(p.venda || 0).toFixed(2)}</span>
                    <div style="display:none;">${cat} ${nome} ${p.cor}</div> 
                `;
                div.appendChild(el);
            });
        }

        // 4. FILTRO DE BUSCA
        function filtrarProdutos() {
            const termo = document.getElementById('busca').value.toLowerCase();
            const catFiltro = document.getElementById('filtro-cat').value;
            
            const cards = document.querySelectorAll('.product-card');
            cards.forEach(card => {
                const texto = card.innerText.toLowerCase();
                const tagCat = card.querySelector('.prod-cat-tag').innerText.toLowerCase();
                
                const matchNome = texto.includes(termo);
                const matchCat = catFiltro === "" || tagCat.includes(catFiltro);

                card.style.display = (matchNome && matchCat) ? 'flex' : 'none';
            });
        }

        // 5. CLIENTES E DATALIST
        function renderizarDatalistClientes() {
            const dl = document.getElementById('lista-clientes-db');
            dl.innerHTML = "";
            dbClientes.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c.nome;
                let extra = [];
                if(c.cpf) extra.push(c.cpf);
                if(c.whats) extra.push(c.whats);
                opt.innerText = extra.length > 0 ? extra.join(' - ') : '';
                dl.appendChild(opt);
            });
        }

        // 6. CARRINHO
        function adicionarAoCarrinho(produto) {
            carrinho.push(produto);
            atualizarTotais();
        }
        function removerDoCarrinho(index) {
            carrinho.splice(index, 1);
            atualizarTotais();
        }

        // 7. TROCAS (MODAL)
        function abrirModalTroca() { document.getElementById('modal-troca').style.display = 'flex'; }
        function fecharModalTroca() { document.getElementById('modal-troca').style.display = 'none'; }

        function confirmarTroca() {
            const troca = {
                modelo: document.getElementById('troca-modelo').value,
                gb: document.getElementById('troca-gb').value,
                cor: document.getElementById('troca-cor').value,
                imei: document.getElementById('troca-imei').value,
                valor: parseFloat(document.getElementById('troca-valor').value) || 0,
                bateria: document.getElementById('troca-bateria').value
            };

            if(!troca.modelo || !troca.valor || !troca.imei) return alert("Preencha Modelo, IMEI e Valor!");
            if(troca.imei.length !== 15) return alert("IMEI deve ter 15 dÃ­gitos.");

            trocas.push(troca);
            fecharModalTroca();
            atualizarTotais();
            document.querySelectorAll('#modal-troca input').forEach(i => i.value = '');
        }

        function removerTroca(index) {
            trocas.splice(index, 1);
            atualizarTotais();
        }

        function atualizarTotais() {
            const divC = document.getElementById('carrinho-lista');
            const divT = document.getElementById('lista-trocas');
            divC.innerHTML = ""; divT.innerHTML = "";

            let sub = 0;
            carrinho.forEach((item, i) => {
                sub += parseFloat(item.venda || 0);
                divC.innerHTML += `
                    <div class="cart-item">
                        <div class="item-info"><div>${item.modelo || item.nomeP}</div><small>R$ ${parseFloat(item.venda).toFixed(2)}</small></div>
                        <i class="fas fa-trash btn-remove" onclick="removerDoCarrinho(${i})"></i>
                    </div>`;
            });

            let desc = 0;
            trocas.forEach((item, i) => {
                desc += item.valor;
                divT.innerHTML += `
                    <div class="trade-in-box">
                        <div class="trade-in-text"><strong>ENTRADA:</strong> ${item.modelo}<br><small>IMEI: ${item.imei} | R$ ${item.valor}</small></div>
                        <i class="fas fa-times btn-remove" onclick="removerTroca(${i})"></i>
                    </div>`;
            });

            totalVendaGlobal = sub - desc;
            document.getElementById('valor-subtotal').innerText = `R$ ${sub.toFixed(2)}`;
            document.getElementById('valor-desconto').innerText = `- R$ ${desc.toFixed(2)}`;
            document.getElementById('valor-total').innerText = `R$ ${totalVendaGlobal.toFixed(2)}`;
        }

        // 8. FINALIZAR VENDA (BAIXA CORRETA)
        async function finalizarVenda() {
            const nomeCliente = document.getElementById('cliente-input').value;
            const pagto = document.getElementById('forma-pagamento').value;

            if(carrinho.length === 0) return alert("Carrinho vazio!");
            if(!nomeCliente) return alert("Selecione um cliente!");

            if(!confirm(`Confirmar venda de R$ ${totalVendaGlobal.toFixed(2)} para ${nomeCliente}?`)) return;

            try {
                const batch = db.batch(); 
                
                // 1. BAIXA NO ESTOQUE (Usa ID do item do carrinho)
                carrinho.forEach(item => {
                    const ref = db.collection("estoque").doc(item.id);
                    batch.update(ref, { status: "vendido", dataVenda: Date.now(), clienteVenda: nomeCliente });
                });

                // 2. ENTRADA DA TROCA
                trocas.forEach(t => {
                    const ref = db.collection("estoque").doc();
                    batch.set(ref, {
                        categoria: 'celular',
                        modelo: `${t.modelo} (TROCA ${nomeCliente})`, 
                        nomeP: `${t.modelo} (TROCA)`, // Garante compatibilidade
                        marca: 'Apple',
                        cor: t.cor,
                        gb: t.gb,
                        imei1: t.imei,
                        bateria: t.bateria,
                        custo: t.valor,
                        venda: 0,
                        status: 'disponÃ­vel',
                        fornecedor: `Cliente: ${nomeCliente}`,
                        dataEntrada: Date.now(),
                        obs: 'Entrada via troca no PDV'
                    });
                });

                // 3. REGISTRO DA VENDA
                const vendaRef = db.collection("vendas").doc();
                batch.set(vendaRef, {
                    cliente: nomeCliente,
                    data: new Date().toISOString(),
                    itens: carrinho.map(c => c.modelo || c.nomeP),
                    trocas: trocas.map(t => t.modelo),
                    total: totalVendaGlobal,
                    pagamento: pagto
                });

                await batch.commit();
                alert("Venda realizada com sucesso!");
                window.location.reload();

            } catch(e) {
                console.error(e);
                alert("Erro ao processar venda: " + e.message);
            }
        }

        // 9. GERAR RECIBO (REDIRECIONAMENTO)
        function gerarRecibo() {
            const nomeCliente = document.getElementById('cliente-input').value;
            if(!nomeCliente) return alert("Informe o cliente antes de gerar o recibo!");
            
            if(carrinho.length === 0 && trocas.length === 0) return alert("Adicione produtos ou trocas primeiro!");

            const clienteFull = dbClientes.find(c => c.nome === nomeCliente) || { nome: nomeCliente };

            let itensRecibo = carrinho.map(i => ({ 
                nome: i.modelo || i.nomeP, 
                desc: i.cor || '', 
                preco: i.venda 
            }));
            
            trocas.forEach(t => {
                itensRecibo.push({
                    nome: "TROCA: " + t.modelo,
                    desc: `IMEI: ${t.imei} | ${t.gb}`,
                    preco: -t.valor
                });
            });

            const dados = {
                cliente: clienteFull.nome,
                cpf: clienteFull.cpf || '',
                tel: clienteFull.whats || '',
                endereco: clienteFull.logradouro ? `${clienteFull.logradouro}, ${clienteFull.numero} - ${clienteFull.bairro}` : '',
                itens: itensRecibo,
                total: totalVendaGlobal,
                pagamento: document.getElementById('forma-pagamento').value,
                data: new Date().toLocaleDateString('pt-BR')
            };

            localStorage.setItem('dadosRecibo', JSON.stringify(dados));
            window.location.href = 'orcamento.html';
        }

        // 10. CLIENTES E CEP
        function abrirModalCliente() { document.getElementById('modal-cliente').style.display = 'flex'; }
        function fecharModalCliente() { document.getElementById('modal-cliente').style.display = 'none'; }
        
        function buscarCep() {
            let cep = document.getElementById('novo-cep').value.replace(/\D/g, '');
            if(cep.length === 8) {
                fetch(`https://viacep.com.br/ws/${cep}/json/`).then(r=>r.json()).then(d=>{
                    if(!d.erro){
                        document.getElementById('novo-endereco').value = d.logradouro;
                        document.getElementById('novo-bairro').value = d.bairro;
                        document.getElementById('novo-cidade').value = `${d.localidade}-${d.uf}`;
                        document.getElementById('novo-numero').focus();
                    }
                });
            }
        }

        async function salvarNovoCliente() {
            const nome = document.getElementById('novo-nome').value;
            if(!nome) return alert("Nome obrigatÃ³rio");

            const novo = {
                nome: nome,
                cpf: document.getElementById('novo-cpf').value,
                whats: document.getElementById('novo-zap').value,
                email: document.getElementById('novo-email').value,
                cep: document.getElementById('novo-cep').value,
                logradouro: document.getElementById('novo-endereco').value,
                numero: document.getElementById('novo-numero').value,
                bairro: document.getElementById('novo-bairro').value,
                cidade: document.getElementById('novo-cidade').value
            };

            try {
                await db.collection("clientes").add(novo);
                alert("Cliente cadastrado!");
                document.getElementById('cliente-input').value = nome;
                fecharModalCliente();
            } catch(e) {
                alert("Erro ao salvar: " + e.message);
            }
        }

        function carregarOpcoesPagamento() {
            const s = document.getElementById('forma-pagamento');
            s.innerHTML = `<optgroup label="Ã€ Vista"><option>Pix</option><option>Dinheiro</option><option>DÃ©bito</option></optgroup><optgroup label="CrÃ©dito">`;
            for(let i=1; i<=18; i++) s.innerHTML += `<option>CrÃ©dito ${i}x</option>`;
        }
    </script>
</body>
</html>
