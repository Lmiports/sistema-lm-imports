<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDV - Vendas e Trocas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    
    <style>
        :root {
            --bg: #020617; --card: #0f172a; --accent: #00e0ff; --text: #f8fafc;
            --border: rgba(255, 255, 255, 0.1); --success: #22c55e; --danger: #ef4444; --warning: #eab308;
        }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; height: 100vh; display: flex; flex-direction: column; box-sizing: border-box; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
        .header h2 { margin: 0; color: var(--accent); letter-spacing: 2px; }
        .btn-voltar { color: #fff; text-decoration: none; font-size: 20px; }

        .main-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; flex: 1; overflow: hidden; }

        .products-section { display: flex; flex-direction: column; gap: 15px; overflow-y: hidden; }
        .search-box { display: flex; gap: 10px; }
        .search-box input, .search-box select { width: 100%; padding: 12px; background: var(--card); border: 1px solid var(--border); color: #fff; border-radius: 8px; outline: none; }
        .products-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; overflow-y: auto; padding-right: 5px; }
        
        .product-card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 15px; cursor: pointer; transition: 0.2s; position: relative; display: flex; flex-direction: column; justify-content: space-between; }
        .product-card:hover { border-color: var(--accent); transform: translateY(-3px); }
        .prod-cat-tag { font-size: 10px; text-transform: uppercase; background: rgba(0, 224, 255, 0.1); color: var(--accent); padding: 4px 8px; border-radius: 4px; width: fit-content; margin-bottom: 5px; font-weight: bold; }
        .prod-name { font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        .prod-detail { font-size: 11px; color: #94a3b8; margin-bottom: 5px; }
        .prod-price { color: var(--success); font-weight: bold; font-size: 16px; margin-top: auto; }

        .cart-section { background: var(--card); border-radius: 15px; border: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; }
        .client-area { margin-bottom: 15px; }
        .client-row { display: flex; gap: 5px; }
        .client-input-wrapper { width: 100%; position: relative; }
        .client-row input[list] { width: 100%; padding: 10px; background: #1e293b; border: 1px solid var(--border); color: #fff; border-radius: 5px; box-sizing: border-box; }
        .btn-add-client { background: var(--success); color: #000; border: none; width: 40px; border-radius: 5px; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; }
        
        .cart-items { flex: 1; overflow-y: auto; margin-bottom: 15px; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); padding: 10px 0; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 5px; margin-bottom: 8px; }
        .cart-item.brinde { border: 1px solid var(--accent); background: rgba(0, 224, 255, 0.1); }
        
        .item-info div { font-size: 13px; font-weight: bold; }
        .item-info small { font-size: 10px; color: #94a3b8; display: block; }
        .item-actions { display: flex; gap: 10px; align-items: center; }
        .btn-icon { cursor: pointer; padding: 5px; font-size: 14px; transition: 0.2s; }
        .btn-remove { color: var(--danger); }
        .btn-gift { color: #94a3b8; }
        .btn-gift.active { color: var(--accent); text-shadow: 0 0 5px var(--accent); }

        .trade-in-box { background: rgba(234, 179, 8, 0.1); border: 1px solid var(--warning); padding: 10px; border-radius: 8px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .trade-in-text { font-size: 12px; color: var(--warning); }
        
        .totals { margin-bottom: 15px; font-size: 14px; }
        .row { display: flex; justify-content: space-between; margin-bottom: 5px; align-items: center;}
        .total-final { font-size: 24px; font-weight: 900; color: var(--success); border-top: 1px solid var(--border); padding-top: 10px; }
        .input-desconto { width: 100px !important; padding: 5px !important; text-align: right; background: #0f172a; border: 1px solid #334155; color: var(--danger); font-weight: bold; }

        .btn-finalizar { background: var(--success); color: #000; padding: 15px; width: 100%; border: none; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; }
        .btn-troca { background: transparent; border: 1px solid var(--warning); color: var(--warning); padding: 10px; width: 100%; border-radius: 8px; margin-bottom: 10px; cursor: pointer; }
        .btn-recibo { background: #eab308; color: #000; padding: 15px; width: 100%; border: none; border-radius: 8px; font-weight: bold; margin-top: 10px; cursor: pointer; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal { background: var(--card); padding: 25px; border-radius: 15px; width: 400px; max-width: 90%; max-height: 90vh; overflow-y: auto; border: 1px solid var(--border); }
        .modal input, .modal select { width: 100%; padding: 10px; margin: 5px 0; background: #1e293b; border: 1px solid var(--border); color: #fff; border-radius: 5px; box-sizing: border-box; }
        .modal h3 { margin-top: 0; color: var(--accent); }
        .modal-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-cancel { flex: 1; padding: 10px; background: #334155; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
        .btn-confirm { flex: 1; padding: 10px; background: var(--success); color: #000; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }

        @media (max-width: 768px) { .main-grid { grid-template-columns: 1fr; overflow-y: auto; } .cart-section { margin-top: 20px; } body { height: auto; } }
    </style>
</head>
<body>

    <div class="header">
        <a href="index.html" class="btn-voltar"><i class="fas fa-arrow-left"></i></a>
        <h2>PDV | VENDAS</h2>
        <div></div>
    </div>

    <div class="main-grid">
        <div class="products-section">
            <div class="search-box">
                <input type="text" id="busca" placeholder="Buscar produto..." onkeyup="filtrarProdutos()">
                <select id="filtro-cat" onchange="filtrarProdutos()" style="width: 150px;">
                    <option value="">Todas</option>
                    <option value="celular">üì± Celulares</option>
                    <option value="roupa">üëï Roupas</option>
                    <option value="perfume">üå∏ Perfumes</option>
                    <option value="acessorio">üéß Acess√≥rios</option>
                </select>
            </div>
            <div class="products-list" id="lista-produtos">
                <div style="padding:20px; text-align:center; color:#888;">Carregando Estoque...</div>
            </div>
        </div>

        <div class="cart-section">
            <div class="client-area">
                <label style="font-size: 12px; color: #94a3b8;">Cliente:</label>
                <div class="client-row">
                    <div class="client-input-wrapper">
                        <input list="lista-clientes-db" id="cliente-input" placeholder="Busca inteligente..." autocomplete="off" onchange="salvarRascunho()">
                        <datalist id="lista-clientes-db"></datalist>
                    </div>
                    <button class="btn-add-client" onclick="abrirModalCliente()">+</button>
                </div>
            </div>

            <div class="cart-items" id="carrinho-lista">
                <div style="text-align: center; color: #64748b; margin-top: 20px;">Carrinho vazio</div>
            </div>

            <div id="lista-trocas"></div>

            <div class="totals">
                <div class="row"><span>Subtotal:</span><span id="valor-subtotal">R$ 0,00</span></div>
                
                <div class="row" style="color: var(--danger);">
                    <span>Desconto (R$):</span>
                    <input type="number" class="input-desconto" id="valor-desconto-manual" value="" placeholder="0,00" oninput="atualizarTotais()">
                </div>
                
                <div class="row" style="color: var(--warning);"><span>Troca/Abatimento:</span><span id="valor-abatimento">- R$ 0,00</span></div>
                <div class="row total-final"><span>TOTAL:</span><span id="valor-total">R$ 0,00</span></div>
            </div>

            <div style="margin-bottom: 10px;">
                <label style="font-size: 12px;">Pagamento:</label>
                <select id="forma-pagamento" style="width: 100%; padding: 8px; background: #1e293b; color: #fff; border: 1px solid var(--border); border-radius: 5px;" onchange="salvarRascunho()">
                    </select>
            </div>

            <button class="btn-troca" onclick="abrirModalTroca()"><i class="fas fa-exchange-alt"></i> Entrada de Troca</button>
            <button class="btn-finalizar" onclick="finalizarVenda()"><i class="fas fa-check"></i> FINALIZAR VENDA</button>
            <button class="btn-recibo" onclick="gerarRecibo()"><i class="fas fa-file-contract"></i> RECIBO & CONTRATO</button>
        </div>
    </div>

    <div class="modal-overlay" id="modal-troca">
        <div class="modal" style="border-color: var(--warning);">
            <h3 style="color: var(--warning);">Entrada de Troca</h3>
            <label style="font-size: 11px; color: #999;">Modelo:</label>
            <input list="dl-modelos-list" id="troca-modelo" placeholder="Selecione...">
            <datalist id="dl-modelos-list"></datalist>
            <div class="modal-grid">
                <div>
                    <label style="font-size: 11px; color: #999;">GB:</label>
                    <select id="troca-gb"><option value="">-</option><option value="64GB">64GB</option><option value="128GB">128GB</option><option value="256GB">256GB</option><option value="512GB">512GB</option></select>
                </div>
                <div>
                    <label style="font-size: 11px; color: #999;">Cor:</label>
                    <input list="dl-cores-list" id="troca-cor" placeholder="Cor">
                    <datalist id="dl-cores-list"></datalist>
                </div>
            </div>
            <label style="font-size: 11px; color: #999;">IMEI:</label>
            <input type="text" id="troca-imei" placeholder="15 d√≠gitos" maxlength="15">
            <div class="modal-grid">
                <div><label style="font-size: 11px; color: #999;">Valor (R$):</label><input type="number" id="troca-valor"></div>
                <div><label style="font-size: 11px; color: #999;">Bateria (%):</label><input type="number" id="troca-bateria"></div>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button onclick="fecharModalTroca()" class="btn-cancel">Cancelar</button>
                <button onclick="confirmarTroca()" class="btn-confirm" style="background: var(--warning);">Confirmar</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-cliente">
        <div class="modal">
            <h3>Novo Cliente</h3>
            <input type="text" id="novo-nome" placeholder="Nome Completo">
            <div class="modal-grid"><input type="text" id="novo-zap" placeholder="Zap"><input type="text" id="novo-cpf" placeholder="CPF"></div>
            <input type="email" id="novo-email" placeholder="Email">
            <div class="modal-grid"><input type="text" id="novo-cep" placeholder="CEP" onblur="buscarCep()"><input type="text" id="novo-numero" placeholder="N¬∫"></div>
            <input type="text" id="novo-endereco" placeholder="Endere√ßo">
            <div class="modal-grid"><input type="text" id="novo-bairro" placeholder="Bairro"><input type="text" id="novo-cidade" placeholder="Cidade"></div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="fecharModalCliente()" class="btn-cancel">Cancelar</button>
                <button onclick="salvarNovoCliente()" class="btn-confirm">Salvar</button>
            </div>
        </div>
    </div>

    <script>
        let dbEstoque = [], dbClientes = [], carrinho = [], trocas = [];
        let totalVendaGlobal = 0;

        // INICIALIZA√á√ÉO
        window.onload = function() {
            carregarOpcoesPagamento();
            
            // Tenta restaurar Rascunho (Se existir)
            restaurarRascunho();

            db.collection("estoque").where("status", "==", "dispon√≠vel").onSnapshot(snap => {
                dbEstoque = []; snap.forEach(doc => dbEstoque.push({ id: doc.id, ...doc.data() }));
                renderizarProdutos();
            });
            db.collection("clientes").orderBy("nome").onSnapshot(snap => {
                dbClientes = []; snap.forEach(doc => dbClientes.push({ id: doc.id, ...doc.data() }));
                renderizarDatalistClientes();
            });
            carregarListasAuxiliares();
        };

        // --- SISTEMA DE RASCUNHO (MEM√ìRIA) ---
        function salvarRascunho() {
            const estado = {
                carrinho: carrinho,
                trocas: trocas,
                cliente: document.getElementById('cliente-input').value,
                desconto: document.getElementById('valor-desconto-manual').value,
                pagamento: document.getElementById('forma-pagamento').value
            };
            localStorage.setItem('pdv_rascunho', JSON.stringify(estado));
        }

        function restaurarRascunho() {
            const salvo = localStorage.getItem('pdv_rascunho');
            if (salvo) {
                const estado = JSON.parse(salvo);
                carrinho = estado.carrinho || [];
                trocas = estado.trocas || [];
                document.getElementById('cliente-input').value = estado.cliente || "";
                document.getElementById('valor-desconto-manual').value = estado.desconto || "";
                
                // Aguarda um pouco para o select carregar antes de setar o valor
                setTimeout(() => {
                    document.getElementById('forma-pagamento').value = estado.pagamento || "Pix";
                }, 500);

                atualizarTotais(); // Atualiza a tela com os dados recuperados
            }
        }

        function limparRascunho() {
            localStorage.removeItem('pdv_rascunho');
            carrinho = [];
            trocas = [];
            document.getElementById('cliente-input').value = "";
            document.getElementById('valor-desconto-manual').value = "";
            atualizarTotais();
        }

        // --- FUN√á√ïES DO SISTEMA ---
        function carregarListasAuxiliares() {
            db.collection("lista_modelos_cel").orderBy("nome").onSnapshot(snap => {
                document.getElementById('dl-modelos-list').innerHTML = "";
                snap.forEach(doc => document.getElementById('dl-modelos-list').innerHTML += `<option value="${doc.data().nome}">`);
            });
            db.collection("lista_cores_cel").orderBy("nome").onSnapshot(snap => {
                document.getElementById('dl-cores-list').innerHTML = "";
                snap.forEach(doc => document.getElementById('dl-cores-list').innerHTML += `<option value="${doc.data().nome}">`);
            });
        }

        function renderizarProdutos() {
            const div = document.getElementById('lista-produtos'); div.innerHTML = "";
            if (dbEstoque.length === 0) return div.innerHTML = '<div style="padding:20px; text-align:center; color:#888;">Estoque vazio.</div>';
            dbEstoque.forEach(p => {
                const el = document.createElement('div'); el.className = 'product-card'; el.onclick = () => adicionarAoCarrinho(p);
                let cat = (p.categoria || 'outros').toLowerCase();
                let icon = cat.includes('celular') ? 'üì±' : cat.includes('roupa') ? 'üëï' : cat.includes('perfume') ? 'üå∏' : 'üì¶';
                let nome = p.modelo || p.nomeP || 'Item';
                el.innerHTML = `<span class="prod-cat-tag">${icon} ${cat.toUpperCase()}</span><span class="prod-name">${nome}</span><span class="prod-detail">${p.cor || ''} ${p.gb || ''}</span><span class="prod-price">R$ ${parseFloat(p.venda||0).toFixed(2)}</span><div style="display:none;">${cat} ${nome} ${p.cor}</div>`;
                div.appendChild(el);
            });
        }

        function filtrarProdutos() {
            const t = document.getElementById('busca').value.toLowerCase(); const c = document.getElementById('filtro-cat').value;
            document.querySelectorAll('.product-card').forEach(card => {
                const txt = card.innerText.toLowerCase(); const cat = card.querySelector('.prod-cat-tag').innerText.toLowerCase();
                card.style.display = (txt.includes(t) && (c === "" || cat.includes(c))) ? 'flex' : 'none';
            });
        }

        function renderizarDatalistClientes() {
            const dl = document.getElementById('lista-clientes-db'); dl.innerHTML = "";
            dbClientes.forEach(c => dl.innerHTML += `<option value="${c.nome}">${c.cpf || c.whats || ''}</option>`);
        }

        function adicionarAoCarrinho(p) {
            carrinho.push({ ...p, isBrinde: false });
            atualizarTotais();
            salvarRascunho(); // Salva a cada adi√ß√£o
        }

        function toggleBrinde(index) {
            carrinho[index].isBrinde = !carrinho[index].isBrinde;
            atualizarTotais();
            salvarRascunho();
        }

        function removerDoCarrinho(i) { 
            carrinho.splice(i, 1); 
            atualizarTotais(); 
            salvarRascunho();
        }

        function confirmarTroca() {
            const t = {
                modelo: document.getElementById('troca-modelo').value,
                gb: document.getElementById('troca-gb').value,
                cor: document.getElementById('troca-cor').value,
                imei: document.getElementById('troca-imei').value,
                valor: parseFloat(document.getElementById('troca-valor').value)||0,
                bateria: document.getElementById('troca-bateria').value
            };
            if(!t.modelo || !t.valor || t.imei.length !== 15) return alert("Dados inv√°lidos (IMEI 15 d√≠gitos)");
            trocas.push(t); fecharModalTroca(); atualizarTotais(); salvarRascunho();
            document.querySelectorAll('#modal-troca input').forEach(i=>i.value='');
        }
        function removerTroca(i) { trocas.splice(i, 1); atualizarTotais(); salvarRascunho(); }

        function atualizarTotais() {
            const dc = document.getElementById('carrinho-lista'); const dt = document.getElementById('lista-trocas');
            dc.innerHTML = ""; dt.innerHTML = "";
            
            let sub = 0;
            carrinho.forEach((item, i) => {
                const valorItem = item.isBrinde ? 0 : parseFloat(item.venda || 0);
                sub += valorItem;
                
                const classeBrinde = item.isBrinde ? 'brinde' : '';
                const iconePresente = item.isBrinde ? 'fas fa-gift active' : 'fas fa-gift';
                const textoValor = item.isBrinde ? '<span style="color:#00e0ff; font-weight:bold;">GR√ÅTIS</span>' : `R$ ${parseFloat(item.venda).toFixed(2)}`;

                dc.innerHTML += `
                    <div class="cart-item ${classeBrinde}">
                        <div class="item-info">
                            <div>${item.modelo || item.nomeP}</div>
                            <small>${textoValor}</small>
                        </div>
                        <div class="item-actions">
                            <i class="btn-icon btn-gift ${iconePresente}" onclick="toggleBrinde(${i})" title="Dar como Brinde"></i>
                            <i class="btn-icon btn-remove fas fa-trash" onclick="removerDoCarrinho(${i})"></i>
                        </div>
                    </div>`;
            });

            let descTroca = 0;
            trocas.forEach((item, i) => {
                descTroca += item.valor;
                dt.innerHTML += `<div class="trade-in-box"><div class="trade-in-text"><strong>ENTRADA:</strong> ${item.modelo}<br><small>${item.imei} | R$ ${item.valor}</small></div><i class="fas fa-times btn-remove" onclick="removerTroca(${i})"></i></div>`;
            });

            let descManual = parseFloat(document.getElementById('valor-desconto-manual').value) || 0;
            totalVendaGlobal = sub - descTroca - descManual;
            
            document.getElementById('valor-subtotal').innerText = `R$ ${sub.toFixed(2)}`;
            document.getElementById('valor-abatimento').innerText = `- R$ ${descTroca.toFixed(2)}`;
            document.getElementById('valor-total').innerText = `R$ ${totalVendaGlobal.toFixed(2)}`;
            
            salvarRascunho(); // Garante que o desconto manual seja salvo
        }

        async function finalizarVenda() {
            const cli = document.getElementById('cliente-input').value;
            const pg = document.getElementById('forma-pagamento').value;
            if(carrinho.length===0) return alert("Carrinho vazio!");
            if(!cli) return alert("Cliente obrigat√≥rio!");
            if(!confirm(`Fechar venda de R$ ${totalVendaGlobal.toFixed(2)}?`)) return;

            try {
                const batch = db.batch();
                carrinho.forEach(item => {
                    batch.update(db.collection("estoque").doc(item.id), { status: "vendido", dataVenda: Date.now(), clienteVenda: cli, foiBrinde: item.isBrinde });
                });
                trocas.forEach(t => {
                    const ref = db.collection("estoque").doc();
                    batch.set(ref, { 
                        categoria:'celular', modelo:`${t.modelo} (TROCA ${cli})`, nomeP:`${t.modelo} (TROCA)`, 
                        marca:'Apple', cor:t.cor, gb:t.gb, imei1:t.imei, bateria:t.bateria, custo:t.valor, venda:0, 
                        status:'dispon√≠vel', fornecedor:`Cliente: ${cli}`, dataEntrada:Date.now() 
                    });
                });
                batch.set(db.collection("vendas").doc(), {
                    cliente: cli, data: new Date().toISOString(),
                    itens: carrinho.map(c => ({ modelo: c.modelo||c.nomeP, isBrinde: c.isBrinde })),
                    trocas: trocas.map(t => t.modelo),
                    desconto: parseFloat(document.getElementById('valor-desconto-manual').value) || 0,
                    total: totalVendaGlobal, pagamento: pg
                });
                await batch.commit();
                
                limparRascunho(); // LIMPA O RASCUNHO AO FINALIZAR
                alert("Venda Sucesso!"); 
                window.location.reload();
            } catch(e) { alert("Erro: "+e.message); }
        }

        function gerarRecibo() {
            const cli = document.getElementById('cliente-input').value;
            if(!cli) return alert("Selecione cliente!");
            if(carrinho.length===0 && trocas.length===0) return alert("Vazio!");

            const cFull = dbClientes.find(c => c.nome === cli) || { nome: cli };
            
            let itensR = carrinho.map(i => ({ 
                nome: i.modelo || i.nomeP, 
                desc: i.cor || '', 
                preco: i.venda,
                isBrinde: i.isBrinde
            }));
            trocas.forEach(t => itensR.push({ nome: "TROCA: "+t.modelo, desc: t.imei, preco: -t.valor, isTroca: true }));

            const dados = {
                cliente: cFull.nome, cpf: cFull.cpf||'', tel: cFull.whats||'', 
                endereco: cFull.logradouro ? `${cFull.logradouro}, ${cFull.numero} - ${cFull.bairro}` : '',
                itens: itensR,
                descontoManual: parseFloat(document.getElementById('valor-desconto-manual').value) || 0,
                total: totalVendaGlobal,
                pagamento: document.getElementById('forma-pagamento').value,
                data: new Date().toLocaleDateString('pt-BR')
            };
            localStorage.setItem('dadosRecibo', JSON.stringify(dados));
            
            // ABRIR EM NOVA ABA (A M√ÅGICA PARA N√ÉO PERDER O PDV)
            window.open('orcamento.html', '_blank');
        }

        function abrirModalTroca(){document.getElementById('modal-troca').style.display='flex';}
        function fecharModalTroca(){document.getElementById('modal-troca').style.display='none';}
        function abrirModalCliente(){document.getElementById('modal-cliente').style.display='flex';}
        function fecharModalCliente(){document.getElementById('modal-cliente').style.display='none';}
        function buscarCep(){
            let cep=document.getElementById('novo-cep').value.replace(/\D/g,'');
            if(cep.length===8) fetch(`https://viacep.com.br/ws/${cep}/json/`).then(r=>r.json()).then(d=>{if(!d.erro){document.getElementById('novo-endereco').value=d.logradouro;document.getElementById('novo-bairro').value=d.bairro;document.getElementById('novo-cidade').value=`${d.localidade}-${d.uf}`;document.getElementById('novo-numero').focus();}});
        }
        async function salvarNovoCliente(){
            let n=document.getElementById('novo-nome').value; if(!n)return alert("Nome?");
            try{ await db.collection("clientes").add({nome:n, cpf:document.getElementById('novo-cpf').value, whats:document.getElementById('novo-zap').value, email:document.getElementById('novo-email').value, cep:document.getElementById('novo-cep').value, logradouro:document.getElementById('novo-endereco').value, numero:document.getElementById('novo-numero').value, bairro:document.getElementById('novo-bairro').value, cidade:document.getElementById('novo-cidade').value}); alert("Ok!"); document.getElementById('cliente-input').value=n; fecharModalCliente(); salvarRascunho(); }catch(e){alert("Erro");}
        }
        function carregarOpcoesPagamento(){
            let s=document.getElementById('forma-pagamento'); 
            s.innerHTML=`<optgroup label="√Ä Vista"><option>Pix</option><option>Dinheiro</option><option>D√©bito</option></optgroup><optgroup label="Cr√©dito">`;
            for(let i=1;i<=24;i++) s.innerHTML+=`<option>Cr√©dito ${i}x</option>`;
        }
    </script>
</body>
</html>
