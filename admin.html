<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VÉRTICE | Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>

    <style>
        :root {
            --bg: #020617; --card: #0f172a; --accent: #00e0ff; --text: #f8fafc;
            --success: #10b981; --danger: #ef4444; --border: #1e293b;
        }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* SIDEBAR (PADRÃO VÉRTICE) */
        .sidebar { width: 250px; background: #000; border-right: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; }
        .logo { color: var(--accent); text-align: center; font-weight: bold; font-size: 24px; margin-bottom: 40px; letter-spacing: 2px; }
        .nav-item { padding: 15px; color: #94a3b8; text-decoration: none; border-radius: 8px; margin-bottom: 5px; display: flex; align-items: center; gap: 10px; transition: 0.3s; cursor: pointer; }
        .nav-item:hover, .nav-item.active { background: var(--accent); color: #000; box-shadow: 0 0 15px rgba(0, 224, 255, 0.3); font-weight: bold; }

        /* CONTEÚDO PRINCIPAL */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        
        /* HEADER */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .user-info { text-align: right; }
        .user-name { font-weight: bold; color: var(--accent); font-size: 18px; }

        /* CARDS KPI */
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background: var(--card); border: 1px solid var(--border); padding: 20px; border-radius: 10px; position: relative; }
        .kpi-title { font-size: 12px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; }
        .kpi-value { font-size: 24px; font-weight: bold; margin-top: 5px; color: #fff; }
        .kpi-icon { position: absolute; right: 20px; top: 20px; font-size: 24px; color: var(--accent); opacity: 0.2; }

        /* GRÁFICOS */
        .charts-area { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; height: 400px; }
        .chart-card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 20px; }
        
        @media (max-width: 1000px) { .charts-area { grid-template-columns: 1fr; height: auto; } }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="logo">VÉRTICE</div>
        <nav>
            <a href="#" class="nav-item active"><i class="fas fa-chart-pie"></i> Dashboard</a>
            <a href="vendas.html" class="nav-item"><i class="fas fa-cash-register"></i> PDV (Caixa)</a>
            <a href="#" class="nav-item" style="opacity:0.5;"><i class="fas fa-box"></i> Estoque</a>
            
            <a href="equipe.html" class="nav-item"><i class="fas fa-users"></i> Equipe</a>
            
            <div style="margin-top: auto;">
                <a href="index.html" class="nav-item" style="color: var(--danger);"><i class="fas fa-sign-out-alt"></i> Sair</a>
            </div>
        </nav>
    </aside>

    <main class="main-content">
        <div class="header">
            <h2 style="margin:0;">Visão Geral</h2>
            <div class="user-info">
                <div style="font-size:12px; color:#aaa;">Bem-vindo</div>
                <div class="user-name">ADMINISTRADOR</div>
            </div>
        </div>

        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-title">Vendas Hoje</div>
                <div class="kpi-value" id="kpi-vendas">R$ 0,00</div>
                <i class="fas fa-shopping-cart kpi-icon"></i>
            </div>
            <div class="kpi-card">
                <div class="kpi-title">Pedidos</div>
                <div class="kpi-value" id="kpi-pedidos">0</div>
                <i class="fas fa-receipt kpi-icon"></i>
            </div>
            <div class="kpi-card">
                <div class="kpi-title">Ticket Médio</div>
                <div class="kpi-value" id="kpi-ticket">R$ 0,00</div>
                <i class="fas fa-chart-line kpi-icon"></i>
            </div>
        </div>

        <div class="charts-area">
            <div class="chart-card">
                <canvas id="graficoVendas"></canvas>
            </div>
            <div class="chart-card">
                <canvas id="graficoCategorias"></canvas>
            </div>
        </div>
    </main>

    <script>
        // Segurança
        if(localStorage.getItem('cargoUsuario') !== 'admin') {
            window.location.href = 'index.html';
        }

        // --- LÓGICA DE DADOS (SIMPLIFICADA PARA CARREGAR RÁPIDO) ---
        async function carregarDados() {
            const hoje = new Date();
            const inicioDia = new Date(hoje.setHours(0,0,0,0)).toISOString();

            try {
                // Pega vendas de hoje
                const snap = await db.collection("vendas").where("data", ">=", inicioDia).get();
                
                let total = 0;
                let pedidos = 0;

                snap.forEach(doc => {
                    let v = doc.data();
                    let valor = typeof v.total === 'number' ? v.total : parseFloat(v.total.replace('R$', '').replace('.', '').replace(',', '.'));
                    total += valor;
                    pedidos++;
                });

                document.getElementById('kpi-vendas').innerText = total.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'});
                document.getElementById('kpi-pedidos').innerText = pedidos;
                
                if(pedidos > 0) {
                    document.getElementById('kpi-ticket').innerText = (total/pedidos).toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'});
                }

                initGraficos(); // Inicia gráficos visuais

            } catch (e) {
                console.error("Erro dados:", e);
            }
        }

        function initGraficos() {
            const ctx1 = document.getElementById('graficoVendas').getContext('2d');
            new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: ['08h', '10h', '12h', '14h', '16h', '18h'],
                    datasets: [{
                        label: 'Vendas Hoje',
                        data: [0, 500, 1200, 1800, 2500, 3200], // Dados exemplo
                        borderColor: '#00e0ff',
                        tension: 0.4
                    }]
                },
                options: { responsive: true, plugins: { legend: { labels: { color: '#fff' } } }, scales: { y: { ticks: { color: '#aaa' } }, x: { ticks: { color: '#aaa' } } } }
            });
            
            const ctx2 = document.getElementById('graficoCategorias').getContext('2d');
            new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Celular', 'Acessório'],
                    datasets: [{ data: [80, 20], backgroundColor: ['#00e0ff', '#ef4444'], borderWidth: 0 }]
                },
                options: { responsive: true, plugins: { legend: { position: 'bottom', labels: { color: '#fff' } } } }
            });
        }

        carregarDados();
    </script>
</body>
</html>
