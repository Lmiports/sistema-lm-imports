<!DOCTYPE html><html lang="pt-br"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>VÉRTICE - ADMINISTRAÇÃO PRO</title>    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>    <script src="js/firebase-config.js"></script>
    <style>
        :root { --bg: #020617; --card: #0f172a; --accent: #3b82f6; --border: #1e293b; --text: #f8fafc; --success: #10b981; --warning: #f59e0b; --danger: #ef4444; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .login-box { background: var(--card); padding: 40px; border: 1px solid var(--accent); border-radius: 12px; text-align: center; width: 300px; box-shadow: 0 0 30px rgba(59, 130, 246, 0.2); }
        .login-input { width: 100%; padding: 15px; background: #000; border: 1px solid #333; color: #fff; font-size: 18px; text-align: center; margin-bottom: 20px; border-radius: 8px; box-sizing: border-box; }
        .login-btn { width: 100%; padding: 15px; background: var(--accent); color: #fff; border: none; font-weight: bold; border-radius: 8px; cursor: pointer; text-transform: uppercase; width: 100%; }

        .sidebar { width: 250px; background: #000; border-right: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; }
        .logo { color: var(--accent); text-align: center; font-weight: 900; font-size: 22px; margin-bottom: 40px; letter-spacing: 3px; }
        .nav-item { padding: 15px; color: #64748b; text-decoration: none; border-radius: 8px; margin-bottom: 5px; display: flex; align-items: center; gap: 10px; font-weight: 600; }
        .nav-item:hover, .nav-item.active { background: var(--accent); color: #fff; }

        .content { flex: 1; padding: 30px; overflow-y: auto; display: none; }

        /* TABS DE CATEGORIA */
        .filter-tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .f-tab { padding: 8px 16px; background: #1e293b; border: 1px solid var(--border); border-radius: 20px; font-size: 11px; cursor: pointer; color: #94a3b8; white-space: nowrap; text-transform: uppercase; font-weight: bold; }
        .f-tab.active { background: var(--accent); color: #fff; border-color: var(--accent); }

        .kpi-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-bottom: 30px; }
        .kpi-card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid var(--border); position: relative; }
        .kpi-title { font-size: 10px; color: #94a3b8; text-transform: uppercase; font-weight: bold; }
        .kpi-value { font-size: 20px; font-weight: 900; margin-top: 10px; color: #fff; }

        .dashboard-row { display: grid; grid-template-columns: 2fr 1.2fr; gap: 20px; margin-bottom: 20px; }
        .panel { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; display: flex; flex-direction: column; }
        .filter-bar { background: #1e293b; padding: 10px; border-radius: 8px; display: flex; gap: 10px; align-items: center; margin-bottom: 15px; }
        .date-input { background: #000; border: 1px solid var(--border); color: #fff; padding: 8px; border-radius: 6px; font-size: 12px; }

        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: #64748b; font-size: 10px; text-transform: uppercase; border-bottom: 1px solid var(--border); padding: 12px 8px; }
        td { padding: 12px 8px; border-bottom: 1px solid var(--border); font-size: 13px; color: #cbd5e1; }
        .badge-troca { background: rgba(245, 158, 11, 0.2); color: var(--warning); padding: 2px 6px; border-radius: 4px; font-size: 9px; border: 1px solid var(--warning); text-transform: uppercase; }

        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; height: auto; }
            .sidebar { display: none; }
            .content { padding: 15px; display: block; }
            .kpi-grid { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px; }
            .kpi-card { min-width: 150px; }
            .dashboard-row { grid-template-columns: 1fr; }
            .panel { overflow-x: auto; }
        }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2 style="color:var(--accent); letter-spacing: 2px;">VÉRTICE ADMIN</h2>
            <input type="password" id="admin-pass" class="login-input" placeholder="Senha Mestra">
            <button class="login-btn" onclick="verificarSenha()">ENTRAR</button>
            <p id="msg-error" style="color:var(--danger); font-size:12px; margin-top:10px; display:none;">Senha incorreta!</p>
        </div>
    </div>

    <aside class="sidebar">
        <div class="logo">VÉRTICE</div>
        <nav>
            <a href="index.html" class="nav-item"><i class="fas fa-home"></i> Início</a>
            <a href="admin.html" class="nav-item active"><i class="fas fa-chart-pie"></i> Painel Financeiro</a>
        </nav>
    </aside>

    <main class="content" id="app-content">
        <header style="margin-bottom:20px;">
            <h1 style="font-size:24px; font-weight:900; margin:0; color:var(--accent);">ANÁLISE FINANCEIRA</h1>
        </header>

        <div class="filter-tabs">
            <div class="f-tab active" onclick="filtrarKPIs('todos', this)">Todos</div>
            <div class="f-tab" onclick="filtrarKPIs('celular', this)">Celulares</div>
            <div class="f-tab" onclick="filtrarKPIs('roupa', this)">Roupas</div>
            <div class="f-tab" onclick="filtrarKPIs('perfume', this)">Perfumes</div>
            <div class="f-tab" onclick="filtrarKPIs('acessorio', this)">Acessórios</div>
        </div>

        <div class="kpi-grid">
            <div class="kpi-card"><div class="kpi-title">Estoque Qtd</div><div class="kpi-value" id="kpi-qtd">0</div></div>
            <div class="kpi-card" style="border-left: 4px solid var(--danger);"><div class="kpi-title" style="color:var(--danger)">Custo</div><div class="kpi-value" id="kpi-custo" style="color:var(--danger)">R$ 0,00</div></div>
            <div class="kpi-card" style="border-left: 4px solid var(--accent);"><div class="kpi-title" style="color:var(--accent)">Venda</div><div class="kpi-value" id="kpi-venda" style="color:var(--accent)">R$ 0,00</div></div>
            <div class="kpi-card" style="border-left: 4px solid var(--success);"><div class="kpi-title" style="color:var(--success)">Lucro</div><div class="kpi-value" id="kpi-lucro" style="color:var(--success)">R$ 0,00</div></div>
            <div class="kpi-card" style="border-left: 4px solid var(--warning);"><div class="kpi-title" style="color:var(--warning)">Margem</div><div class="kpi-value" id="kpi-margem" style="color:var(--warning)">0%</div></div>
        </div>

        <div class="dashboard-row">
            <div class="panel">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h3 style="margin:0; font-size:15px; color:var(--success); font-weight:900;">HISTÓRICO DE VENDAS</h3>
                    <h3 id="total-periodo" style="margin:0; font-size:18px; color:var(--success)">R$ 0,00</h3>
                </div>
                <div class="filter-bar">
                    <input type="date" id="dataInicio" class="date-input">
                    <input type="date" id="dataFim" class="date-input">
                    <button onclick="carregarVendas()" style="background:var(--accent); border:none; color:#fff; padding:8px 15px; border-radius:6px; cursor:pointer; font-weight:bold; font-size:11px;">FILTRAR</button>
                </div>
                <div style="flex:1; overflow-y:auto; max-height:400px;">
                    <table>
                        <thead><tr><th>Data</th><th>Cliente</th><th style="text-align:right;">Total</th></tr></thead>
                        <tbody id="lista-vendas"></tbody>
                    </table>
                </div>
            </div>

            <div style="display:flex; flex-direction:column; gap:20px;">
                <div class="panel">
                    <h3 style="margin:0 0 10px 0; font-size:11px; color:#94a3b8; font-weight:900;">MIX DE CATEGORIAS</h3>
                    <div style="height:180px;"><canvas id="graficoEstoque"></canvas></div>
                </div>
                <div class="panel" style="flex:1;">
                    <h3 style="margin:0 0 10px 0; font-size:11px; color:var(--warning); font-weight:900;">ÚLTIMAS TROCAS</h3>
                    <div style="overflow-y:auto; max-height:300px;">
                        <table style="min-width: unset;"><tbody id="lista-trocas"></tbody></table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let estoqueGlobal = [];
        let chartInstance = null;

        function cleanNum(v) { 
            if(typeof v === 'number') return v;
            return parseFloat(String(v || 0).replace(/[R$\s.]/g, '').replace(',', '.')) || 0; 
        }

        async function verificarSenha() {
            if(document.getElementById('admin-pass').value === "1234") {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-content').style.display = 'block';
                iniciar();
            } else { document.getElementById('msg-error').style.display = 'block'; }
        }

        function iniciar() {
            const hoje = new Date();
            document.getElementById('dataInicio').valueAsDate = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
            document.getElementById('dataFim').valueAsDate = hoje;
            carregarDadosEstoque();
            carregarVendas();
            carregarTrocas();
        }

        function carregarDadosEstoque() {
            db.collection("estoque").onSnapshot(snap => {
                estoqueGlobal = [];
                snap.forEach(doc => { if(doc.data().status !== 'vendido') estoqueGlobal.push(doc.data()); });
                filtrarKPIs('todos', document.querySelector('.f-tab.active'));
                atualizarGrafico();
            });
        }

        function filtrarKPIs(categoria, el) {
            if(el) {
                document.querySelectorAll('.f-tab').forEach(t => t.classList.remove('active'));
                el.classList.add('active');
            }
            let filtrados = categoria === 'todos' ? estoqueGlobal : estoqueGlobal.filter(p => (p.categoria || '').toLowerCase().includes(categoria));
            
            let qtd=0, custo=0, venda=0;
            filtrados.forEach(p => { qtd++; custo += cleanNum(p.custo); venda += cleanNum(p.venda); });

            document.getElementById('kpi-qtd').innerText = qtd;
            document.getElementById('kpi-custo').innerText = custo.toLocaleString('pt-br',{style:'currency',currency:'BRL'});
            document.getElementById('kpi-venda').innerText = venda.toLocaleString('pt-br',{style:'currency',currency:'BRL'});
            document.getElementById('kpi-lucro').innerText = (venda-custo).toLocaleString('pt-br',{style:'currency',currency:'BRL'});
            document.getElementById('kpi-margem').innerText = venda > 0 ? ((venda-custo)/venda*100).toFixed(1)+'%' : '0%';
        }

        async function carregarVendas() {
            const ini = new Date(document.getElementById('dataInicio').value + "T00:00:00").getTime();
            const fim = new Date(document.getElementById('dataFim').value + "T23:59:59").getTime();
            const snap = await db.collection("vendas").orderBy("data","desc").get();
            let html = "", total = 0;
            snap.forEach(doc => {
                const v = doc.data();
                if(v.data >= ini && v.data <= fim) {
                    let val = cleanNum(v.total); total += val;
                    html += `<tr><td>${new Date(v.data).toLocaleDateString('pt-BR')}</td><td><strong>${v.clienteNome}</strong></td><td style="text-align:right; font-weight:bold; color:${val<0?'var(--warning)':'var(--success)'}">${val.toLocaleString('pt-br',{style:'currency',currency:'BRL'})}</td></tr>`;
                }
            });
            document.getElementById('lista-vendas').innerHTML = html;
            document.getElementById('total-periodo').innerText = total.toLocaleString('pt-br',{style:'currency',currency:'BRL'});
        }

        function carregarTrocas() {
            db.collection("estoque").orderBy("dataEntrada", "desc").limit(10).onSnapshot(snap => {
                let html = "";
                snap.forEach(doc => {
                    const t = doc.data();
                    if(t.observacao && t.observacao.toLowerCase().includes("troca")) {
                        html += `<tr><td><div style="font-weight:bold;">${t.modelo}</div><div style="font-size:10px; opacity:0.6;">${t.cor || ''}</div></td><td style="text-align:center;"><span class="badge-troca">TROCA</span></td><td style="text-align:right; font-weight:bold; color:var(--warning);">R$ ${cleanNum(t.custo).toFixed(2)}</td></tr>`;
                    }
                });
                document.getElementById('lista-trocas').innerHTML = html;
            });
        }

        function atualizarGrafico() {
            const ctx = document.getElementById('graficoEstoque').getContext('2d');
            let dados = {}; 
            estoqueGlobal.forEach(p => { let c = p.categoria || 'Outros'; dados[c] = (dados[c] || 0) + cleanNum(p.venda); });
            if(chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: { labels: Object.keys(dados), datasets: [{ data: Object.values(dados), backgroundColor: ['#3b82f6','#8b5cf6','#ec4899','#f59e0b','#64748b'], borderWidth: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { color: '#fff', boxWidth: 10, font: { size: 10 } } } } }
            });
        }
    </script>
</body></html>