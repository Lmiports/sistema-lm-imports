<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | VÉRTICE BI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>

    <style>
        :root {
            --bg: #020617; --accent: #00e0ff; --accent-glow: rgba(0, 224, 255, 0.5);
            --text: #f8fafc; --glass: rgba(15, 23, 42, 0.6); --border: rgba(255, 255, 255, 0.1);
        }
        body {
            margin: 0; padding: 0; font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            background-image: radial-gradient(at 0% 0%, rgba(0, 224, 255, 0.15) 0px, transparent 50%), radial-gradient(at 100% 100%, rgba(139, 92, 246, 0.15) 0px, transparent 50%);
            height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden; color: var(--text);
        }
        .background-grid {
            position: absolute; width: 200%; height: 200%;
            background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px; transform: perspective(500px) rotateX(60deg) translateY(-100px) translateZ(-200px);
            animation: moveGrid 20s linear infinite; z-index: -1; opacity: 0.4;
        }
        @keyframes moveGrid { 0% { transform: perspective(500px) rotateX(60deg) translateY(0) translateZ(-200px); } 100% { transform: perspective(500px) rotateX(60deg) translateY(50px) translateZ(-200px); } }

        .login-container { width: 100%; max-width: 400px; padding: 20px; perspective: 1000px; position: relative; z-index: 10; transition: 0.5s; }
        .login-card {
            background: var(--glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border); padding: 40px; border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); text-align: center;
            transform: translateY(20px); opacity: 0; animation: slideUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }
        @keyframes slideUp { to { transform: translateY(0); opacity: 1; } }

        .logo { font-size: 2rem; font-weight: 900; margin-bottom: 5px; letter-spacing: -1px; color: #fff; }
        .logo span { color: var(--accent); text-shadow: 0 0 20px var(--accent-glow); }
        .subtitle { font-size: 0.85rem; color: #94a3b8; margin-bottom: 30px; text-transform: uppercase; letter-spacing: 2px; }

        .input-group { margin-bottom: 20px; text-align: left; }
        .input-group label { display: block; font-size: 0.8rem; color: #94a3b8; margin-bottom: 8px; margin-left: 5px; }
        .input-wrapper { position: relative; }
        .input-wrapper i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #64748b; transition: 0.3s; }
        input { width: 100%; padding: 15px 15px 15px 45px; background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border); border-radius: 10px; color: #fff; font-size: 1rem; outline: none; transition: 0.3s; box-sizing: border-box; }
        input:focus { border-color: var(--accent); box-shadow: 0 0 15px rgba(0, 224, 255, 0.1); background: rgba(0, 224, 255, 0.05); }
        input:focus + i { color: var(--accent); }

        .toggle-pass { right: 15px; left: auto !important; cursor: pointer; }
        .toggle-pass:hover { color: #fff; }

        .btn-login {
            width: 100%; padding: 15px; background: linear-gradient(135deg, #00e0ff 0%, #0066ff 100%);
            border: none; border-radius: 10px; color: #fff; font-weight: 700; font-size: 1rem; cursor: pointer;
            margin-top: 10px; transition: 0.3s; text-transform: uppercase; letter-spacing: 1px;
            box-shadow: 0 10px 20px -5px rgba(0, 224, 255, 0.3);
        }
        .btn-login:hover { transform: translateY(-2px); box-shadow: 0 15px 30px -5px rgba(0, 224, 255, 0.5); }
        .btn-login.loading { pointer-events: none; opacity: 0.8; font-size: 0; }
        .btn-login.loading::after { content: ''; display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3); border-top-color: #fff; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to {transform: rotate(360deg);} }

        #welcome-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 20; opacity: 0; pointer-events: none; transition: opacity 0.8s;
        }
        #welcome-screen.active { opacity: 1; pointer-events: all; }
        .welcome-text { font-size: 3rem; font-weight: 900; color: #fff; text-align: center; transform: scale(0.8); transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        #welcome-screen.active .welcome-text { transform: scale(1); }
        .welcome-text span { color: var(--accent); display: block; font-size: 4rem; text-shadow: 0 0 40px var(--accent); margin-top: 10px; }
        .welcome-sub { margin-top: 20px; color: #94a3b8; font-size: 1.2rem; letter-spacing: 3px; text-transform: uppercase; }
        .fade-out { opacity: 0; transform: scale(0.9); pointer-events: none; }
    </style>
</head>
<body>
    <div class="background-grid"></div>
    <div class="login-container" id="loginBox">
        <div class="login-card">
            <div class="logo">VÉRTICE <span>BI</span></div>
            <div class="subtitle">Gestão Inteligente</div>
            <form id="loginForm" onsubmit="fazerLogin(event)">
                <div class="input-group">
                    <label>USUÁRIO</label>
                    <div class="input-wrapper"><input type="text" id="user" placeholder="admin" required><i class="fas fa-user"></i></div>
                </div>
                <div class="input-group">
                    <label>SENHA</label>
                    <div class="input-wrapper"><input type="password" id="pass" placeholder="••••••••" required><i class="fas fa-lock"></i><i class="fas fa-eye toggle-pass" onclick="toggleSenha()"></i></div>
                </div>
                <button type="submit" class="btn-login" id="btnEntrar">Acessar Sistema</button>
            </form>
            <div style="margin-top: 25px; font-size: 0.75rem; color: #475569;">Sistema Exclusivo &copy; 2023</div>
        </div>
    </div>

    <div id="welcome-screen">
        <div class="welcome-text">SEJA BEM-VINDO <span>VÉRTICE BI</span></div>
        <div class="welcome-sub">Carregando Ambiente...</div>
    </div>

    <script>
        function toggleSenha() {
            const input = document.getElementById('pass');
            input.type = input.type === "password" ? "text" : "password";
        }

        async function fazerLogin(e) {
            e.preventDefault();
            const btn = document.getElementById('btnEntrar');
            // Força minúsculo para bater com o banco (lm imports)
            const userDigitado = document.getElementById('user').value.toLowerCase().trim();
            const passDigitado = document.getElementById('pass').value.trim();
            const loginBox = document.getElementById('loginBox');
            const welcomeScreen = document.getElementById('welcome-screen');

            btn.classList.add('loading');

            try {
                // Tenta coleção 'Usuários' (Maiúsculo)
                let snapshot = await db.collection("Usuários").where("usuario", "==", userDigitado).where("senha", "==", passDigitado).get();
                
                // Se não achar, tenta 'usuarios' (Minúsculo) por garantia
                if (snapshot.empty) {
                    snapshot = await db.collection("usuarios").where("usuario", "==", userDigitado).where("senha", "==", passDigitado).get();
                }

                if (!snapshot.empty) {
                    const dadosUsuario = snapshot.docs[0].data();
                    
                    // --- SALVA O CRACHÁ ---
                    localStorage.setItem('usuarioLogado', dadosUsuario.usuario);
                    localStorage.setItem('cargoUsuario', dadosUsuario.cargo);

                    // --- ANIMAÇÃO ---
                    loginBox.classList.add('fade-out');
                    setTimeout(() => {
                        welcomeScreen.classList.add('active');
                        document.querySelector('.welcome-text span').innerText = userDigitado.toUpperCase();
                    }, 300);

                    setTimeout(() => {
                        // --- REDIRECIONAMENTO CORRETO ---
                        if (dadosUsuario.cargo === 'admin') {
                            window.location.href = 'admin.html';
                        } else {
                            window.location.href = 'vendas.html';
                        }
                    }, 2500);
                } else {
                    btn.classList.remove('loading');
                    alert("Login Inválido!\nVerifique se digitou: 'lm imports' e a senha correta.");
                }
            } catch (error) {
                console.error(error);
                btn.classList.remove('loading');
                alert("Erro de conexão com o banco de dados.");
            }
        }
    </script>
</body>
</html>
