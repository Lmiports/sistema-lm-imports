<script>
    // Função para mostrar/esconder senha visualmente
    function toggleSenha() {
        const input = document.getElementById('pass');
        const icon = document.querySelector('.toggle-pass');
        if (input.type === "password") {
            input.type = "text";
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            input.type = "password";
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }

    async function fazerLogin(e) {
        e.preventDefault();
        const btn = document.getElementById('btnEntrar');
        
        // Pega o que foi digitado
        const userDigitado = document.getElementById('user').value.toLowerCase().trim();
        const passDigitado = document.getElementById('pass').value.trim();
        
        const loginBox = document.getElementById('loginBox');
        const welcomeScreen = document.getElementById('welcome-screen');

        btn.classList.add('loading');

        try {
            // --- AQUI ESTÁ A MÁGICA ---
            // Agora o código busca na coleção 'equipe'
            // E procura pelos campos 'login' e 'pass' (que o corretor não estraga)
            
            const snapshot = await db.collection("equipe")
                .where("login", "==", userDigitado)
                .where("pass", "==", passDigitado)
                .get();

            if (!snapshot.empty) {
                // --- SUCESSO: ENCONTROU O USUÁRIO ---
                const dados = snapshot.docs[0].data();
                
                // Salva quem logou e o cargo (role)
                localStorage.setItem('usuarioLogado', dados.login);
                localStorage.setItem('cargoUsuario', dados.role); 

                // --- EFEITOS VISUAIS ---
                loginBox.classList.add('fade-out');
                
                setTimeout(() => {
                    welcomeScreen.classList.add('active');
                    document.querySelector('.welcome-text span').innerText = userDigitado.toUpperCase();
                }, 300);

                setTimeout(() => {
                    // Redireciona: Se o role for 'admin', vai pro dashboard
                    if (dados.role === 'admin') {
                        window.location.href = 'admin.html';
                    } else {
                        window.location.href = 'vendas.html';
                    }
                }, 2500);

            } else {
                // ERRO: SENHA OU USUÁRIO INCORRETOS
                btn.classList.remove('loading');
                alert("Login incorreto!\n\nTente usar:\nUsuário: admin\nSenha: 1234");
            }

        } catch (error) {
            console.error(error);
            btn.classList.remove('loading');
            alert("Erro de conexão. Verifique se a coleção 'equipe' foi criada corretamente.");
        }
    }
</script>
